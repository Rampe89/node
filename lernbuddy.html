<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Informatik Lernbuddy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* Brutalist core (wie Landing) */
      --bg: #f6f4ef;
      --ink: #111111;
      --muted: #333333;
      --line: #111111;

      /* Accents */
      --hi: #ff3b30;
      --hi2:#0057ff;
      --hi3:#00c853;
      --paper:#fffdf8;

      /* Layout */
      --max: 1120px;
      --pad: 18px;
      --gap: 14px;
      --bw: 2px;
      --shadowInk: rgba(17,17,17,.95);
      --shadow: 8px 8px 0 var(--shadowInk);
      --shadow2: 6px 6px 0 var(--shadowInk);

      --mono: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        linear-gradient(0deg, rgba(0,0,0,.05) 1px, transparent 1px) 0 0/ 22px 22px,
        linear-gradient(90deg, rgba(0,0,0,.05) 1px, transparent 1px) 0 0/ 22px 22px,
        var(--bg);
      line-height: 1.65;
      padding: 18px var(--pad) 40px;
    }

    a{ color: inherit; }

    /* Page shell */
    .page{
      width: 100%;
      max-width: var(--max);
      margin: 0 auto;
      background: var(--paper);
      border: var(--bw) solid var(--line);
      box-shadow: var(--shadow);
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    @media (max-width: 768px){
      body{ padding: 12px; }
      .page{
        padding: 12px;
        box-shadow: var(--shadow2);
      }
    }

    /* Header */
    header{
      padding-bottom: 12px;
      border-bottom: var(--bw) solid var(--line);
      margin-bottom: 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-main{ max-width: 720px; }

    .header-source{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      text-align: right;
      line-height: 1.7;
      border: var(--bw) solid var(--line);
      background: #fff;
      box-shadow: 4px 4px 0 var(--shadowInk);
      padding: 10px 12px;
      text-transform: uppercase;
      letter-spacing: .06em;
    }

    @media (max-width: 768px){
      .header-source{ text-align:left; }
    }

    .hero-tag{
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-family: var(--mono);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing:.10em;
      padding: 8px 10px;
      border: var(--bw) solid var(--line);
      background: #fff;
      box-shadow: 4px 4px 0 var(--shadowInk);
      margin-bottom: 10px;
    }
    .hero-tag-dot{
      width:10px;height:10px;
      background: var(--hi3);
      border: var(--bw) solid var(--line);
      box-shadow: 3px 3px 0 var(--shadowInk);
    }

    header h1{
      margin: 0 0 6px;
      font-size: clamp(22px, 2.8vw, 34px);
      line-height:1.05;
      letter-spacing:-0.02em;
      font-weight: 900;
      text-transform: uppercase;
    }

    header p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      max-width: 72ch;
    }

    main{ margin-top: 6px; }

    /* Sections = Panels im Brutal-Look */
    .section{
      border: var(--bw) solid var(--line);
      background: #fff;
      box-shadow: var(--shadow2);
      padding: 14px;
      margin-bottom: 14px;
      position:relative;
      overflow:hidden;
      background:
        linear-gradient(0deg, rgba(0,0,0,.035) 1px, transparent 1px) 0 0/ 16px 16px,
        var(--paper);
    }
    .section::before{
      content:"";
      position:absolute;
      right:-18px;
      top:-18px;
      width:62px;height:62px;
      background: var(--hi);
      border: var(--bw) solid var(--line);
      transform: rotate(12deg);
      opacity:.85;
      pointer-events:none;
    }

    .section h2{
      margin:0 0 10px;
      font-size: 16px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .02em;
      display:flex;
      align-items:center;
      gap:10px;
      padding-bottom: 8px;
      border-bottom: var(--bw) dashed var(--line);
    }

    .section-subtitle{
      margin: 0 0 10px;
      font-family: var(--mono);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.7;
    }

    /* Step badge */
    .step-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 28px;
      height: 28px;
      padding: 0 8px;
      border: var(--bw) solid var(--line);
      background: var(--hi2);
      color: #fff;
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      box-shadow: 4px 4px 0 var(--shadowInk);
    }

    /* Layout grids */
    .grid{
      display:grid;
      grid-template-columns: 2fr 1.1fr;
      gap: var(--gap);
      margin-bottom: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .inline-grid{
      display:grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px){
      .inline-grid{ grid-template-columns: 1fr; }
    }

    .field-group{ margin-bottom: 12px; }
    .field-group label{
      display:block;
      font-size: 13px;
      font-weight: 800;
      letter-spacing:.01em;
      margin-bottom: 4px;
      text-transform: uppercase;
    }
    .field-group small{
      display:block;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      line-height: 1.7;
    }

    /* Inputs */
    input[type="text"],
    textarea{
      width:100%;
      padding: 10px 10px;
      border: var(--bw) solid var(--line);
      background: #fff;
      color: var(--ink);
      font-size: 14px;
      font-family: var(--sans);
      box-shadow: 4px 4px 0 var(--shadowInk);
      outline: none;
      resize: vertical;
      min-height: 40px;
    }
    textarea{ min-height: 84px; }

    input[type="text"]:focus,
    textarea:focus{
      outline: 3px solid var(--hi2);
      outline-offset: 3px;
    }

    /* Tag labels */
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 8px;
      border: var(--bw) solid var(--line);
      background:#fff;
      box-shadow: 3px 3px 0 var(--shadowInk);
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .tag::before{
      content:"";
      width:10px;height:10px;
      border: var(--bw) solid var(--line);
      background: var(--hi3);
      box-shadow: 2px 2px 0 var(--shadowInk);
    }

    /* Checkbox list */
    .checkbox-list{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .checkbox-list li{
      border: var(--bw) solid var(--line);
      background:#fff;
      box-shadow: 4px 4px 0 var(--shadowInk);
      padding: 10px;
    }
    .checkbox-list label{
      display:flex;
      align-items:flex-start;
      gap:10px;
      font-size: 14px;
      line-height: 1.6;
    }
    .checkbox-list input[type="checkbox"]{
      margin-top: 2px;
      width: 18px;
      height: 18px;
      accent-color: var(--hi2);
    }

    /* Radio group (dein bestehender Markup bleibt) */
    .field-group .radio-group label{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding: 10px;
      border: var(--bw) solid var(--line);
      background:#fff;
      box-shadow: 4px 4px 0 var(--shadowInk);
      margin-bottom: 10px;
      cursor:pointer;
      font-size: 14px;
      line-height: 1.6;
    }
    .field-group .radio-group input[type="radio"]{
      margin-top: 2px;
      width: 18px;
      height: 18px;
      accent-color: var(--hi2);
    }

    /* Scratch frame wrapper */
    #scratch-frame-wrapper{
      width:100%;
      height: 460px;
      margin-top: 10px;
      border: var(--bw) solid var(--line);
      background:#fff;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    #scratch-frame-wrapper p{
      padding: 10px;
      text-align:center;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      line-height: 1.8;
      margin:0;
    }
    @media (max-width: 900px){ #scratch-frame-wrapper{ height: 320px; } }
    @media (max-width: 600px){ #scratch-frame-wrapper{ height: 260px; } }

    /* Actions + Buttons im Brutal-Look */
    .actions{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top: 10px;
      align-items:center;
      padding-top: 10px;
      border-top: var(--bw) dashed var(--line);
    }
    @media (max-width: 600px){
      .actions{ flex-direction: column; align-items: stretch; }
    }

    button{
      border: var(--bw) solid var(--line);
      background: #fff;
      color: var(--ink);
      padding: 10px 12px;
      cursor:pointer;
      font-family: var(--mono);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing:.08em;
      box-shadow: 4px 4px 0 var(--shadowInk);
      transition: transform .12s ease, filter .12s ease;
    }
    button:hover{ transform: translate(-2px,-2px); filter: brightness(1.02); }
    button:focus-visible{
      outline: 3px solid var(--hi2);
      outline-offset: 3px;
    }

    .btn-primary{
      background: var(--hi);
      color: var(--paper);
    }
    .btn-secondary{
      background:#fff;
      color: var(--ink);
    }

    .small-note{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      line-height: 1.7;
    }

    .status{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--hi3);
      min-height: 1.2em;
    }

    /* Intro Overlay im gleichen Stil */
    #intro-overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 1000;
      padding: 18px;
    }
    #intro-overlay.hidden{ display:none; }

    #intro-modal{
      width: min(860px, calc(100vw - 36px));
      border: var(--bw) solid var(--line);
      background: #fff;
      box-shadow: var(--shadow);
      padding: 14px;
    }

    #intro-modal h2{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .02em;
      padding-bottom: 8px;
      border-bottom: var(--bw) dashed var(--line);
    }

    #intro-modal p{
      margin: 8px 0;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.7;
    }

    #intro-modal ul{
      margin: 8px 0 8px 22px;
      padding:0;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.7;
    }
    #intro-modal li{ margin-bottom: 6px; }

    #intro-modal-footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
      padding-top: 10px;
      border-top: var(--bw) dashed var(--line);
    }

    #intro-modal-footer label{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing:.06em;
    }

    #intro-modal-footer input[type="checkbox"]{
      width: 18px;
      height: 18px;
      accent-color: var(--hi2);
    }

    /* Print */
    @media print{
      body{
        background: #fff;
        padding: 0;
      }
      .page{
        box-shadow:none;
        border: 0;
        padding: 0 12px 12px;
      }
      .section{
        box-shadow:none;
      }
      .actions button{ display:none; }
      #status-msg{ display:none; }
      #intro-overlay{ display:none !important; }
      input[type="text"], textarea{
        box-shadow:none;
      }
    }

    @media (prefers-reduced-motion: reduce){
      button{ transition:none; }
      button:hover{ transform:none; }
    }
  </style>
</head>
<body>

<div class="page">
  <header>
    <div class="header-main">
      <div class="hero-tag">
        <span class="hero-tag-dot"></span>
        <span>Informatik · Lernbuddy</span>
      </div>
      <h1>Informatik Lernbuddy</h1>
      <p>Hilft dir beim Planen, Arbeiten und Nachdenken über deine Aufgabe.</p>
    </div>
    <div class="header-source">
      Quelle/Idee von:<br>
      Xenia Weber-Reuter, Joachim Wirth und Ferdinand Stebner
    </div>
  </header>

  <!-- Intro-Overlay -->
  <div id="intro-overlay" class="hidden" aria-modal="true" role="dialog">
    <div id="intro-modal">
      <h2>Warum nutzen wir diesen Lernbuddy?</h2>
      <p>In Informatik geht es nicht nur darum, dass dein Programm funktioniert.</p>
      <p>Wichtig ist auch, wie du lernst und arbeitest. Dieser Lernbuddy hilft dir dabei:</p>
      <ul>
        <li>Du planst vorher, was du machen willst</li>
        <li>Du achtest beim Arbeiten auf dein Vorgehen</li>
        <li>Du denkst am Ende darüber nach, was gut war und was du ändern möchtest</li>
      </ul>
      <p>
        Das nennt man auch „selbstreguliertes Lernen“. Das heißt:
        Du überlegst selbst, wie du lernst, und passt dein Lernen an.
      </p>
      <p>
        Nimm dir kurz Zeit für die Fragen. Sie sollen dir helfen,
        dein Lernen Schritt für Schritt zu verbessern.
      </p>
      <div id="intro-modal-footer">
        <label>
          <input type="checkbox" id="intro-hide-next">
          Diesen Hinweis beim nächsten Mal nicht mehr anzeigen
        </label>
        <button type="button" class="btn-primary" id="intro-ok-btn">Weiter zum Lernbuddy</button>
      </div>
    </div>
  </div>

  <main>
    <!-- Kopfdaten -->
    <section class="section" id="meta-section">
      <h2>Angaben zur Arbeit</h2>
      <div class="inline-grid">
        <div class="field-group">
          <label for="student-name">Name</label>
          <input type="text" id="student-name" placeholder="Vorname Nachname">
        </div>
        <div class="field-group">
          <label for="student-class">Klasse</label>
          <input type="text" id="student-class" placeholder="z. B. 7b">
        </div>
        <div class="field-group">
          <label for="student-date">Datum</label>
          <input type="text" id="student-date" placeholder="z. B. 15.09.2025">
        </div>
      </div>
    </section>

    <!-- 1. Vor dem Programmieren -->
    <section class="section" id="before-section">
      <h2>
        <span class="step-badge">1</span>
        Bevor du programmierst
      </h2>
      <p class="section-subtitle">Hier überlegst du kurz, was du heute machen willst.</p>

      <div class="field-group">
        <span class="tag">Ziele</span>
      </div>

      <div class="field-group">
        <label for="goal-what">Mein WAS-Ziel</label>
        <small>Was soll am Ende klappen? Schreibe es in einem einfachen Satz.</small>
        <textarea id="goal-what" placeholder="Beispiel: Meine Figur kann sich mit den Pfeiltasten bewegen."></textarea>
      </div>

      <div class="field-group">
        <label for="goal-how">Mein WIE-Ziel</label>
        <small>Was möchtest du heute üben? Zum Beispiel Schleifen, Bedingungen oder Variablen.</small>
        <textarea id="goal-how" placeholder="Beispiel: Ich möchte eine Schleife und eine Wenn-Dann-Bedingung benutzen."></textarea>
      </div>

      <div class="field-group">
        <span class="tag">Ablenkung und Motivation</span>
      </div>

      <div class="field-group">
        <label for="distractions">Was lenkt mich ab? Was hilft mir?</label>
        <small>Schreibe kurz auf, was du jetzt ändern kannst, damit du gut arbeiten kannst.</small>
        <textarea id="distractions" placeholder="Beispiel: Handy weglegen, andere Tabs schließen."></textarea>
      </div>

      <div class="field-group">
        <label for="motivation">Warum lohnt sich das für mich?</label>
        <small>Dein Grund. Er muss nicht perfekt sein.</small>
        <textarea id="motivation" placeholder="Beispiel: Ich will besser programmieren können, weil mir Spiele Spaß machen."></textarea>
      </div>
    </section>

    <!-- 2. Während des Programmierens -->
    <div class="grid">
      <!-- Scratch + Plan -->
      <section class="section" id="middle-section">
        <h2>
          <span class="step-badge">2</span>
          Während du arbeitest
        </h2>
        <p class="section-subtitle">Hier arbeitest du mit Scratch und schreibst dir wichtige Dinge auf.</p>

        <div class="field-group">
          <span class="tag">Scratch-Projekt</span>
        </div>

        <div class="field-group">
          <label for="scratch-url">Link zu deinem Scratch-Projekt</label>
          <small>Beispiel: https://scratch.mit.edu/projects/123456789</small>
          <input type="text" id="scratch-url" placeholder="Scratch-Link hier einfügen">
          <div class="actions" style="margin-top:10px;">
            <button type="button" class="btn-secondary" id="open-editor-btn">Scratch-Editor in neuem Tab öffnen</button>
            <span class="small-note">Hier im Fenster siehst du später die Vorschau. Den Code bearbeitest du im Editor im anderen Tab.</span>
          </div>
        </div>

        <div id="scratch-frame-wrapper">
          <p>
            Hier siehst du dein Scratch-Projekt, wenn du oben einen gültigen Link einträgst.<br>
            Du kannst das Ergebnis hier testen. Den Code änderst du im Editor im anderen Tab.
          </p>
        </div>

        <div class="field-group" style="margin-top: 18px;">
          <span class="tag">Plan</span>
        </div>

        <div class="field-group">
          <label for="plan-notes">Mein Plan / Pseudocode</label>
          <small>Schreibe kurz auf, was du zuerst und was du danach machen willst.</small>
          <textarea id="plan-notes" placeholder="Beispiel: 1. Figur zeichnen  2. Steuerung mit Pfeiltasten  3. Hindernis einbauen"></textarea>
        </div>

        <div class="field-group">
          <span class="tag">Fehler und Lösungen</span>
        </div>

        <div class="field-group">
          <label for="debug-notes">Probleme und wie ich sie gelöst habe</label>
          <small>Hier kannst du dir merken, was nicht geklappt hat und wie du es geschafft hast.</small>
          <textarea id="debug-notes" placeholder="Beispiel: Figur hat sich nicht bewegt → Block an die richtige Figur gesetzt."></textarea>
        </div>
      </section>

      <!-- Check währenddessen -->
      <section class="section" id="during-check-section">
        <h2>
          <span class="step-badge">2½</span>
          Mini-Check zwischendurch
        </h2>
        <p class="section-subtitle">Hake an, was du schon gut gemacht hast.</p>

        <ul class="checkbox-list">
          <li><label><input type="checkbox" id="check-tested"><span>Ich teste mein Projekt immer wieder.</span></label></li>
          <li><label><input type="checkbox" id="check-errors"><span>Ich lese Probleme und Fehlermeldungen und versuche sie zu verstehen.</span></label></li>
          <li><label><input type="checkbox" id="check-steps"><span>Ich ändere nur kleine Dinge auf einmal.</span></label></li>
          <li><label><input type="checkbox" id="check-help"><span>Ich hole mir Hilfe, wenn ich feststecke.</span></label></li>
          <li><label><input type="checkbox" id="check-focus"><span>Ich bleibe bei meiner Aufgabe und springe nicht dauernd hin und her.</span></label></li>
        </ul>
      </section>
    </div>

    <!-- 3. Nach dem Programmieren -->
    <section class="section" id="after-section">
      <h2>
        <span class="step-badge">3</span>
        Wenn du fertig bist
      </h2>
      <p class="section-subtitle">Zum Schluss schaust du kurz auf dein Ziel und deine Arbeit.</p>

      <div class="field-group"><span class="tag">Rückblick</span></div>

      <div class="field-group">
        <label>Habe ich mein WAS-Ziel geschafft?</label>
        <small>Wie gut passt dein Ergebnis zu deinem Ziel von oben?</small>
        <div class="radio-group">
          <label><input type="radio" name="goal-what-result" value="nein"><span>Nein, noch nicht.</span></label>
          <label><input type="radio" name="goal-what-result" value="teilweise"><span>So halb.</span></label>
          <label><input type="radio" name="goal-what-result" value="ja"><span>Ja, das passt.</span></label>
        </div>
      </div>

      <div class="field-group">
        <label>Habe ich mein WIE-Ziel benutzt?</label>
        <small>Hast du die Sachen genutzt, die du üben wolltest?</small>
        <div class="radio-group">
          <label><input type="radio" name="goal-how-result" value="nein"><span>Nein.</span></label>
          <label><input type="radio" name="goal-how-result" value="teilweise"><span>Ein bisschen.</span></label>
          <label><input type="radio" name="goal-how-result" value="ja"><span>Ja, auf jeden Fall.</span></label>
        </div>
      </div>

      <div class="field-group">
        <label for="satisfaction">Worauf bin ich heute stolz?</label>
        <small>Schreibe mindestens eine Sache, die du gut findest.</small>
        <textarea id="satisfaction" placeholder="Beispiel: Ich habe das Problem mit der Steuerung alleine gelöst."></textarea>
      </div>

      <div class="field-group">
        <label for="next-time">Was möchte ich beim nächsten Mal anders machen?</label>
        <small>Nur ein oder zwei Punkte. Kleine Schritte reichen.</small>
        <textarea id="next-time" placeholder="Beispiel: Nächstes Mal plane ich zuerst alles und frage früher, wenn ich nicht weiterkomme."></textarea>
      </div>

      <div class="actions">
        <button type="button" class="btn-primary" id="save-btn">Speichern (auf diesem Gerät)</button>
        <button type="button" class="btn-secondary" id="reset-btn">Alles löschen</button>
        <button type="button" class="btn-secondary" id="print-btn">Drucken oder als PDF speichern</button>
        <div class="status" id="status-msg" aria-live="polite"></div>
      </div>
    </section>
  </main>
</div>

<script>
  const STORAGE_KEY = "informatikLernbuddyV1";
  const INTRO_KEY = "informatikLernbuddyHideIntro";
  let statusTimeoutId = null;

  function getSelectedRadio(name) {
    const radios = document.querySelectorAll("input[name='" + name + "']");
    for (const r of radios) {
      if (r.checked) return r.value;
    }
    return "";
  }

  function setSelectedRadio(name, value) {
    if (!value) return;
    const radios = document.querySelectorAll("input[name='" + name + "']");
    radios.forEach(r => { r.checked = (r.value === value); });
  }

  function setStatus(message, isError) {
    const el = document.getElementById("status-msg");
    if (!el) return;
    el.textContent = message;
    el.style.color = isError ? "#ff3b30" : "#00c853";

    if (statusTimeoutId) clearTimeout(statusTimeoutId);
    statusTimeoutId = setTimeout(() => { el.textContent = ""; }, 4000);
  }

  function updateScratchFrameFromUrl() {
    const input = document.getElementById("scratch-url");
    const wrapper = document.getElementById("scratch-frame-wrapper");
    if (!input || !wrapper) return;

    const url = input.value.trim();
    if (!url || !url.includes("scratch.mit.edu/projects")) {
      wrapper.innerHTML = "<p>Hier siehst du dein Scratch-Projekt, wenn du oben einen gültigen Link einträgst.</p>";
      return;
    }

    const match = url.match(/projects\/(\d+)/);
    if (!match) {
      wrapper.innerHTML = "<p>Der Link passt nicht. Bitte prüfe die Adresse.</p>";
      return;
    }

    const id = match[1];
    wrapper.innerHTML = `
      <iframe
        src="https://scratch.mit.edu/projects/${id}/embed"
        allowtransparency="true"
        frameborder="0"
        scrolling="no"
        allowfullscreen
        style="width:100%; height:100%; border:none;"
      ></iframe>
    `;
  }

  function openScratchEditor() {
    const input = document.getElementById("scratch-url");
    if (!input) return;
    const url = input.value.trim();
    if (!url || !url.includes("scratch.mit.edu/projects")) {
      alert("Bitte gib zuerst einen gültigen Scratch-Link ein.");
      return;
    }

    const match = url.match(/projects\/(\d+)/);
    let editorUrl = url;
    if (match) {
      const id = match[1];
      editorUrl = "https://scratch.mit.edu/projects/" + id + "/editor";
    }
    window.open(editorUrl, "_blank");
  }

  function collectData() {
    return {
      studentName: document.getElementById("student-name").value,
      studentClass: document.getElementById("student-class").value,
      studentDate: document.getElementById("student-date").value,
      goalWhat: document.getElementById("goal-what").value,
      goalHow: document.getElementById("goal-how").value,
      distractions: document.getElementById("distractions").value,
      motivation: document.getElementById("motivation").value,
      scratchUrl: document.getElementById("scratch-url").value,
      planNotes: document.getElementById("plan-notes").value,
      debugNotes: document.getElementById("debug-notes").value,
      checkTested: document.getElementById("check-tested").checked,
      checkErrors: document.getElementById("check-errors").checked,
      checkSteps: document.getElementById("check-steps").checked,
      checkHelp: document.getElementById("check-help").checked,
      checkFocus: document.getElementById("check-focus").checked,
      goalWhatResult: getSelectedRadio("goal-what-result"),
      goalHowResult: getSelectedRadio("goal-how-result"),
      satisfaction: document.getElementById("satisfaction").value,
      nextTime: document.getElementById("next-time").value
    };
  }

  function saveData(showStatus = true) {
    const data = collectData();
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      if (showStatus) setStatus("Gespeichert.", false);
    } catch (e) {
      setStatus("Konnte nicht speichern. (localStorage nicht verfügbar)", true);
    }
  }

  function loadData() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const data = JSON.parse(raw);

        document.getElementById("student-name").value = data.studentName || "";
        document.getElementById("student-class").value = data.studentClass || "";
        document.getElementById("student-date").value = data.studentDate || "";

        document.getElementById("goal-what").value = data.goalWhat || "";
        document.getElementById("goal-how").value = data.goalHow || "";
        document.getElementById("distractions").value = data.distractions || "";
        document.getElementById("motivation").value = data.motivation || "";

        document.getElementById("scratch-url").value = data.scratchUrl || "";
        updateScratchFrameFromUrl();

        document.getElementById("plan-notes").value = data.planNotes || "";
        document.getElementById("debug-notes").value = data.debugNotes || "";

        document.getElementById("check-tested").checked = !!data.checkTested;
        document.getElementById("check-errors").checked = !!data.checkErrors;
        document.getElementById("check-steps").checked = !!data.checkSteps;
        document.getElementById("check-help").checked = !!data.checkHelp;
        document.getElementById("check-focus").checked = !!data.checkFocus;

        setSelectedRadio("goal-what-result", data.goalWhatResult);
        setSelectedRadio("goal-how-result", data.goalHowResult);

        document.getElementById("satisfaction").value = data.satisfaction || "";
        document.getElementById("next-time").value = data.nextTime || "";

        setStatus("Gespeicherte Daten wurden geladen.", false);
      }

      const dateInput = document.getElementById("student-date");
      if (dateInput && dateInput.value.trim() === "") {
        const today = new Date().toLocaleDateString("de-DE");
        dateInput.value = today;
      }
    } catch (e) {
      setStatus("Konnte gespeicherte Daten nicht laden.", true);
    }
  }

  function resetData() {
    if (!confirm("Willst du wirklich alles löschen?")) return;

    localStorage.removeItem(STORAGE_KEY);

    const inputs = document.querySelectorAll("input[type='text'], textarea");
    inputs.forEach(i => i.value = "");

    const checkboxes = document.querySelectorAll("input[type='checkbox']");
    checkboxes.forEach(c => c.checked = false);

    const radios = document.querySelectorAll("input[type='radio']");
    radios.forEach(r => r.checked = false);

    updateScratchFrameFromUrl();
    setStatus("Alles wurde gelöscht.", false);
  }

  function showIntroIfNeeded() {
    const hideIntro = localStorage.getItem(INTRO_KEY);
    const overlay = document.getElementById("intro-overlay");
    if (!overlay) return;

    if (hideIntro === "1") {
      overlay.classList.add("hidden");
    } else {
      overlay.classList.remove("hidden");
    }
  }

  function handleIntroOk() {
    const overlay = document.getElementById("intro-overlay");
    const hideCheckbox = document.getElementById("intro-hide-next");
    if (hideCheckbox && hideCheckbox.checked) {
      localStorage.setItem(INTRO_KEY, "1");
    }
    overlay.classList.add("hidden");
  }

  function autoSaveOnChange() {
    const watchedSelectors = [
      "#student-name",
      "#student-class",
      "#student-date",
      "#goal-what",
      "#goal-how",
      "#distractions",
      "#motivation",
      "#scratch-url",
      "#plan-notes",
      "#debug-notes",
      "#satisfaction",
      "#next-time",
      "#check-tested",
      "#check-errors",
      "#check-steps",
      "#check-help",
      "#check-focus"
    ];

    watchedSelectors.forEach(sel => {
      const el = document.querySelector(sel);
      if (el) {
        el.addEventListener("input", () => saveData(false));
        el.addEventListener("change", () => saveData(false));
      }
    });

    const goalWhatRadios = document.querySelectorAll("input[name='goal-what-result']");
    goalWhatRadios.forEach(r => r.addEventListener("change", () => saveData(false)));

    const goalHowRadios = document.querySelectorAll("input[name='goal-how-result']");
    goalHowRadios.forEach(r => r.addEventListener("change", () => saveData(false)));
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("save-btn").addEventListener("click", () => saveData(true));
    document.getElementById("reset-btn").addEventListener("click", resetData);
    document.getElementById("print-btn").addEventListener("click", () => window.print());
    document.getElementById("scratch-url").addEventListener("input", updateScratchFrameFromUrl);
    document.getElementById("open-editor-btn").addEventListener("click", openScratchEditor);

    const introOkBtn = document.getElementById("intro-ok-btn");
    if (introOkBtn) introOkBtn.addEventListener("click", handleIntroOk);

    loadData();
    showIntroIfNeeded();
    autoSaveOnChange();
  });
</script>
</body>
</html>

