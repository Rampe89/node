<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spamfilter-Demo ¬∑ Regeln vs. Lernendes System</title>
  <style>
    :root{
      --bg:#f6f7fb; --panel:#ffffff; --ink:#0b1220; --muted:#4b5563; --accent:#2563eb;
      --ok:#16a34a; --bad:#dc2626; --border:#e5e7eb; --shadow:0 10px 28px rgba(20,30,55,.08);
      --radius:16px; --meta:#6b7280; --divider:#e7e9ee;
    }
    *{box-sizing:border-box}
    body{margin:0; font:16px/1.6 Inter, ui-sans-serif, system-ui; color:var(--ink); background:var(--bg)}
    .wrap{max-width:1200px; margin:0 auto; padding:22px}
    h1{font-size:26px; margin:0 0 6px; font-weight:800}
    h2{font-size:20px; margin:0 0 8px}
    h3{font-size:16px; margin:0 0 6px}
    .small{font-size:13px; color:var(--muted)}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .divider{height:1px; background:var(--divider); margin:14px 0}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .grid{display:grid; grid-template-columns:360px 1fr; gap:18px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    table{width:100%; border-collapse:collapse; background:#fff; border:1px solid var(--border); border-radius:10px; overflow:hidden}
    th,td{padding:10px; border-bottom:1px solid var(--border); text-align:left}
    thead th{background:#f3f4f6; color:#374151; font-weight:700; font-size:13px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .okText{color:var(--ok)} .badText{color:var(--bad)}

    /* Inbox */
    .inbox-wrap{padding:18px; border:2px solid var(--border); border-radius:20px; background:#fff; box-shadow:var(--shadow)}
    select.mail-select{min-width:320px}
    .email-card{
      display:grid; grid-template-columns:76px 1fr; gap:16px; align-items:flex-start;
      background:#fff; border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow:0 2px 6px rgba(0,0,0,.06)
    }
    .avatar{width:60px; height:60px; border-radius:999px; background:#e5e7eb; display:grid; place-items:center; font-weight:900; color:#1e3a8a; font-size:20px}
    .subject{font-weight:900; font-size:20px}
    .snippet{color:var(--muted); font-size:15px; margin-top:4px}
    .meta{color:var(--meta); font-size:13px; margin-top:6px}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:700; border:1px solid var(--border)}
    .pill.ok{background:#dcfce7; color:#166534; border-color:#bbf7d0}
    .pill.bad{background:#fee2e2; color:#991b1b; border-color:#fecaca}
    .chip{background:#eef2ff; border:1px solid #c7d2fe; color:#1e3a8a; font-size:12px; padding:4px 8px; border-radius:999px; margin-right:6px}

    /* Controls */
    label input[type="checkbox"]{transform:translateY(1px)}
    input[type=range]{width:140px}
    input[type=number]{width:80px}
    button{cursor:pointer; border:1px solid var(--border); border-radius:8px; background:var(--accent); color:#fff; font-weight:700; padding:8px 14px}
    button:hover{opacity:.9}
    a.scratch{display:inline-block; margin-top:8px; padding:10px 14px; border-radius:10px; font-weight:700; text-decoration:none; background:#111827; color:#fff; border:1px solid #111827}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Spamfilter-Demo: Regeln ‚Üí Lernendes System</h1>
      <div class="small">Single-Mail-Ansicht mit Dropdown. Klare Ausgaben f√ºr beide Systeme.</div>
    </header>

    <div class="grid">
      <!-- Sidebar -->
      <aside class="panel" style="align-self:start">
        <h2>Kriterien f√ºr Spam</h2>
        <table>
          <thead><tr><th>Kriterium</th><th>Bedeutung</th></tr></thead>
          <tbody>
            <tr><td>Gratis-Angebot</td><td>Betreff enth√§lt W√∂rter wie ‚Äûgratis‚Äú, ‚Äûkostenlos‚Äú, ‚Äûgeschenkt‚Äú.</td></tr>
            <tr><td>Verd√§chtige Absenderadresse</td><td>Domain im Absender sieht echt aus, ist aber leicht ver√§ndert (z. B. ‚Äûrnicrosoft‚Äú statt ‚Äûmicrosoft‚Äú).</td></tr>
            <tr><td>Gro√übuchstaben</td><td>Betreff vollst√§ndig in Gro√übuchstaben.</td></tr>
            <tr><td>Dringlichkeit</td><td>Druck/Alarm (‚Äûjetzt handeln‚Äú, ‚Äûnur heute‚Äú, ‚Äûsofort‚Äú).</td></tr>
            <tr><td>Werbesprache</td><td>√úbertriebene Promo-Worte (‚Äûexklusiv‚Äú, ‚ÄûSonderaktion‚Äú, ‚ÄûGewinn‚Äú).</td></tr>
          </tbody>
        </table>
      </aside>

      <!-- Main -->
      <main style="display:grid; gap:18px">
        <!-- Inbox -->
        <section class="inbox-wrap">
          <h2>Posteingang</h2>
          <select id="mailSelect" class="mail-select" aria-label="Mail ausw√§hlen"></select>
          <div id="mailView" class="email-card" aria-live="polite"></div>
        </section>

        <!-- Regeln -->
        <section class="panel">
          <h2>Regelbasierte Entscheidung</h2>
          <p class="small">Wenn eine aktivierte Regel zutrifft ‚Üí Spam.</p>
          <div class="row">
            <label><input type="checkbox" class="rule" data-key="g" checked> Gratis-Angebot</label>
            <label><input type="checkbox" class="rule" data-key="k" checked> Verd√§chtige Absenderadresse</label>
            <label><input type="checkbox" class="rule" data-key="l" checked> Gro√übuchstaben</label>
            <label><input type="checkbox" class="rule" data-key="c" checked> Dringlichkeit</label>
            <label><input type="checkbox" class="rule" data-key="d" checked> Werbesprache</label>
          </div>
          <div class="divider"></div>
          <h3>Ausgabe</h3>
          <p><strong>Klasse:</strong> <span id="ruleOut">‚Äì</span></p>
          <p class="small mono" id="ruleWhy"></p>
          <div class="divider"></div>
          <h3>Auswertung (auf gesamten Datensatz)</h3>
          <div class="row small mono">
            <div>Trefferquote: <span id="ruleAcc">‚Äì</span></div>
            <div>TP/TN: <span id="ruleTP">‚Äì</span></div>
            <div>FP/FN: <span id="ruleFP">‚Äì</span></div>
          </div>
          <a class="scratch" href="https://scratch.mit.edu/projects/1228228243/editor/" target="_blank" rel="noopener">üîó Scratch: Spam-Detector (Regeln)</a>
        </section>

        <!-- Lernen -->
        <section class="panel">
          <h2>Lernendes System (Perzeptron)</h2>
          <p class="small">Gewichtete Summe der Kriterien ‚â• Œ∏ ‚áí Spam. Startwerte sind absichtlich nicht optimal.</p>
          <div class="row" style="gap:12px 16px; flex-wrap:wrap">
            <label>w‚ÇÅ Gratis <input id="w0" type="range" min="-2" max="2" step="0.1" value="-0.4"><input id="w0Val" type="number" min="-2" max="2" step="0.1" value="-0.4"></label>
            <label>w‚ÇÇ Absender <input id="w1" type="range" min="-2" max="2" step="0.1" value="0.2"><input id="w1Val" type="number" min="-2" max="2" step="0.1" value="0.2"></label>
            <label>w‚ÇÉ Gro√übuchstaben <input id="w2" type="range" min="-2" max="2" step="0.1" value="0.1"><input id="w2Val" type="number" min="-2" max="2" step="0.1" value="0.1"></label>
            <label>w‚ÇÑ Dringend <input id="w3" type="range" min="-2" max="2" step="0.1" value="-0.3"><input id="w3Val" type="number" min="-2" max="2" step="0.1" value="-0.3"></label>
            <label>w‚ÇÖ Werbung <input id="w4" type="range" min="-2" max="2" step="0.1" value="0.0"><input id="w4Val" type="number" min="-2" max="2" step="0.1" value="0.0"></label>
            <label>Œ∏ <input id="theta" type="range" min="0" max="3" step="0.1" value="1.0"><input id="thetaVal" type="number" min="0" max="3" step="0.1" value="1.0"></label>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="btnTrain">Training starten (10 Epochen)</button>
            <span id="trainStatus" class="small" aria-live="polite"></span>
          </div>
          <div id="trainLog" class="small mono" style="max-height:140px; overflow:auto; border:1px solid var(--border); border-radius:8px; padding:8px; margin-top:8px"></div>

          <div class="divider"></div>
          <h3>Ausgabe</h3>
          <p><strong>Klasse:</strong> <span id="neuOut">‚Äì</span></p>
          <p class="small mono" id="neuSum"></p>

          <div class="divider"></div>
          <h3>Auswertung (auf gesamten Datensatz)</h3>
          <div class="row small mono">
            <div>Trefferquote: <span id="neuAcc">‚Äì</span></div>
            <div>TP/TN: <span id="neuTP">‚Äì</span></div>
            <div>FP/FN: <span id="neuFP">‚Äì</span></div>
          </div>
          <a class="scratch" href="https://scratch.mit.edu/projects/1228380055/editor/" target="_blank" rel="noopener">üîó Scratch: Perzeptron (Lernen)</a>
        </section>

        <!-- Vergleich -->
        <section class="panel">
          <details>
            <summary style="cursor:pointer; font-weight:800">Direkter Vergleich (aufklappen)</summary>
            <div class="divider"></div>
            <table>
              <thead><tr><th>Mail</th><th>Regel</th><th>Perzeptron</th><th>Soll</th></tr></thead>
              <tbody id="compareBody"></tbody>
            </table>
          </details>
        </section>
      </main>
    </div>
  </div>

  <script>
  "use strict";
  document.addEventListener("DOMContentLoaded", () => {
    // ---------- Datensatz (plakative Beispiele) ----------
    const DATA = [
      { subj:"GRATIS IPHONE JETZT SICHERN", from:"rnicrosoft@support-mail.com", g:1,k:1,l:1,c:1,d:1, y:1, snip:"Nur heute ‚Äì exklusives Geschenk!" },
      { subj:"Ihr Paket konnte nicht zugestellt werden", from:"service@am4zon-help.net", g:0,k:1,l:0,c:1,d:0, y:1, snip:"Bitte Adresse best√§tigen f√ºr erneute Zustellung." },
      { subj:"SONDERAKTION NUR HEUTE", from:"deals@shopping-world.net", g:0,k:0,l:1,c:1,d:1, y:1, snip:"70% Rabatt ‚Äì jetzt handeln." },
      { subj:"Dringend: Passwort l√§uft ab", from:"support@schule.de", g:0,k:0,l:0,c:1,d:0, y:0, snip:"Interne Erinnerung: Passwort regelm√§√üig √§ndern." }, // sieht dringend aus, ist aber legit
      { subj:"Elternabend ‚Äì Raum√§nderung", from:"sekretariat@schule.de", g:0,k:0,l:0,c:0,d:0, y:0, snip:"Neuer Raum: B104, Uhrzeit bleibt." }, // klar kein Spam
      { subj:"Gewinn best√§tigt: Jetzt PR√ÑMIE abholen", from:"gewinn@lotto-online.net", g:1,k:0,l:1,c:1,d:1, y:1, snip:"Ihre Pr√§mie wartet ‚Äì Link klicken." },
      { subj:"Newsletter Oktober", from:"newsletter@stadtbibliothek.de", g:0,k:0,l:0,c:0,d:1, y:0, snip:"Neue Medien und Veranstaltungen." }, // nur Werbesprache, aber legit
      { subj:"RECHNUNG Oktober", from:"buchhaltung@service.de", g:0,k:0,l:1,c:0,d:0, y:0, snip:"Anbei die Monatsabrechnung." } // nur ALL CAPS, trotzdem kein Spam
    ];

    // ---------- DOM ----------
    const mailSelect = document.getElementById("mailSelect");
    const mailView   = document.getElementById("mailView");
    const ruleChecks = Array.from(document.querySelectorAll(".rule"));

    const ruleOut = document.getElementById("ruleOut");
    const ruleWhy = document.getElementById("ruleWhy");
    const ruleAcc = document.getElementById("ruleAcc");
    const ruleTP  = document.getElementById("ruleTP");
    const ruleFP  = document.getElementById("ruleFP");

    const neuOut = document.getElementById("neuOut");
    const neuSum = document.getElementById("neuSum");
    const neuAcc = document.getElementById("neuAcc");
    const neuTP  = document.getElementById("neuTP");
    const neuFP  = document.getElementById("neuFP");

    const compareBody = document.getElementById("compareBody");

    const w0=document.getElementById("w0"), w0Val=document.getElementById("w0Val");
    const w1=document.getElementById("w1"), w1Val=document.getElementById("w1Val");
    const w2=document.getElementById("w2"), w2Val=document.getElementById("w2Val");
    const w3=document.getElementById("w3"), w3Val=document.getElementById("w3Val");
    const w4=document.getElementById("w4"), w4Val=document.getElementById("w4Val");
    const theta=document.getElementById("theta"), thetaVal=document.getElementById("thetaVal");
    const btnTrain=document.getElementById("btnTrain");
    const trainStatus=document.getElementById("trainStatus");
    const trainLog=document.getElementById("trainLog");

    let current = 0;

    // ---------- Helpers ----------
    const esc = s => String(s).replace(/[&<>"]/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    const features = m => [m.g,m.k,m.l,m.c,m.d];
    const weights  = () => [parseFloat(w0.value),parseFloat(w1.value),parseFloat(w2.value),parseFloat(w3.value),parseFloat(w4.value)];
    const setWeights = ws => { [w0,w1,w2,w3,w4].forEach((r,i)=>{ r.value = ws[i].toFixed(2); }); syncInputs(); };
    const Œò = () => parseFloat(theta.value);
    const setTheta = t => { theta.value = t.toFixed(2); thetaVal.value = t.toFixed(2); };
    function syncInputs(){ w0Val.value=w0.value; w1Val.value=w1.value; w2Val.value=w2.value; w3Val.value=w3.value; w4Val.value=w4.value; thetaVal.value=theta.value; }

    function ruleDecision(m){
      const active = ruleChecks.filter(ch => ch.checked && m[ch.dataset.key]===1);
      const why = active.map(a=>a.nextSibling.textContent.trim()).join(" OR ") || "‚Äî";
      return { y: active.length>0 ? 1 : 0, why: (active.length?"Match: ":"Regeln: ")+why+(active.length?"":" | Default ‚áí kein Spam") };
    }
    function neuronDecision(m){
      const x = features(m); const w = weights();
      const sum = x.reduce((s,xi,i)=> s + xi*w[i], 0);
      return { y: sum >= Œò() ? 1 : 0, sum };
    }
    function evaluate(modelFn){
      let tp=0, tn=0, fp=0, fn=0;
      for(const m of DATA){
        const yhat = modelFn(m);
        if(yhat===1 && m.y===1) tp++;
        else if(yhat===0 && m.y===0) tn++;
        else if(yhat===1 && m.y===0) fp++;
        else fn++;
      }
      return { acc:(tp+tn)/DATA.length, tp, tn, fp, fn };
    }

    // ---------- Training (Perzeptron) ----------
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function trainPerceptron(epochs=10, lr=0.2){
      trainLog.textContent = "";
      let w = weights();
      let t = Œò();
      for(let e=1; e<=epochs; e++){
        let updates=0;
        for(const m of DATA){
          const x = features(m);
          const sum = x.reduce((s,xi,i)=> s + xi*w[i], 0);
          const yhat = sum >= t ? 1 : 0;
          const err = m.y - yhat;
          if(err!==0){
            for(let i=0;i<w.length;i++) w[i] = clamp(w[i] + lr*err*x[i], -2, 2);
            t = clamp(t - lr*err, 0, 3);
            updates++;
          }
        }
        trainLog.textContent += `Epoche ${e}: ${updates===0?'keine Updates':'Updates: '+updates}\n`;
        if(updates===0) break;
      }
      setWeights(w); setTheta(t);
      trainStatus.textContent = `Training fertig. w=[${w.map(v=>v.toFixed(2)).join(', ')}], Œ∏=${t.toFixed(2)}`;
      update();
    }

    // ---------- Rendering ----------
    function renderSelect(){
      mailSelect.innerHTML = DATA.map((m,i)=>`<option value="${i}">${i+1}. ${esc(m.subj)}</option>`).join("");
      mailSelect.value = String(current);
    }
    function renderMail(){
      const m = DATA[current];
      const chips=[]; if(m.g) chips.push('<span class="chip">Gratis</span>');
      if(m.k) chips.push('<span class="chip">Verd√§chtige Adresse</span>');
      if(m.l) chips.push('<span class="chip">Gro√übuchstaben</span>');
      if(m.c) chips.push('<span class="chip">Dringend</span>');
      if(m.d) chips.push('<span class="chip">Werbung</span>');
      mailView.innerHTML = `
        <div class="avatar" aria-hidden="true">${esc(m.subj[0])}</div>
        <div>
          <div class="subject">${esc(m.subj)}</div>
          <div class="snippet">${esc(m.snip)}</div>
          <div class="meta">Von: ${esc(m.from)} <span class="pill ${m.y?'bad':'ok'}">${m.y?'Soll: Spam':'Soll: kein Spam'}</span></div>
          <div style="margin-top:10px">${chips.join(" ") || '<span class="small" style="color:#9ca3af">keine aktiven Kriterien</span>'}</div>
        </div>`;
    }
    function renderCompare(){
      compareBody.innerHTML = DATA.map(m=>{
        const r = ruleDecision(m).y; const n = neuronDecision(m).y;
        return `<tr><td>${esc(m.subj)}</td><td class="${r?'badText':'okText'}">${r?'Spam':'kein Spam'}</td><td class="${n?'badText':'okText'}">${n?'Spam':'kein Spam'}</td><td class="${m.y?'badText':'okText'}">${m.y?'Spam':'kein Spam'}</td></tr>`;
      }).join("");
    }
    function renderDecisions(){
      const m = DATA[current];
      const r = ruleDecision(m);
      ruleOut.textContent = r.y ? "Spam" : "kein Spam";
      ruleOut.className = r.y ? "badText" : "okText";
      ruleWhy.textContent = r.why;

      const n = neuronDecision(m);
      neuOut.textContent = n.y ? "Spam" : "kein Spam";
      neuOut.className = n.y ? "badText" : "okText";
      neuSum.textContent = `Summe = ${n.sum.toFixed(2)}  ${n.sum >= Œò() ? "‚â•" : "<"}  Œ∏=${Œò().toFixed(2)}`;

      const rs = evaluate(m=>ruleDecision(m).y);
      ruleAcc.textContent = (rs.acc*100).toFixed(0)+"%";
      ruleTP.textContent  = `${rs.tp} / ${rs.tn}`;
      ruleFP.textContent  = `${rs.fp} / ${rs.fn}`;

      const ns = evaluate(m=>neuronDecision(m).y);
      neuAcc.textContent = (ns.acc*100).toFixed(0)+"%";
      neuTP.textContent  = `${ns.tp} / ${ns.tn}`;
      neuFP.textContent  = `${ns.fp} / ${ns.fn}`;
    }
    function update(){ renderMail(); renderDecisions(); renderCompare(); }

    // ---------- Events ----------
    mailSelect.addEventListener("change", ()=>{ current = parseInt(mailSelect.value,10); update(); });
    document.addEventListener("input", e=>{
      if(e.target.matches('.rule, input[type="range"], input[type="number"]')){
        syncInputs(); update();
      }
    });
    [[w0,w0Val],[w1,w1Val],[w2,w2Val],[w3,w3Val],[w4,w4Val],[theta,thetaVal]].forEach(([r,n])=>{
      n.addEventListener("input", ()=>{ r.value = n.value; update(); });
    });
    btnTrain.addEventListener("click", ()=>{ trainStatus.textContent = "Training l√§uft‚Ä¶"; trainPerceptron(10, 0.2); });

    // ---------- Initial ----------
    (function init(){
      renderSelect(); syncInputs(); update();
    })();
  });
  </script>
</body>
</html>










