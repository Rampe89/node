<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Project 230 – Trainingsdashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.08);
      --accent-strong: #4ade80;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #ef4444;
      --warning: #f97316;
      --radius: 14px;
      --shadow-soft: 0 18px 40px rgba(15,23,42,0.55);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background:
        radial-gradient(circle at top, #1d283a 0, #020617 55%),
        radial-gradient(circle at bottom, #020617 0, #000 65%);
      color: var(--text);
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    header h1 {
      margin: 0;
      font-size: 1.9rem;
      letter-spacing: 0.08em;
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
    }

    header h1 span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background:
        linear-gradient(135deg, #4ade80, #22c55e);
      color: #022c22;
      font-size: 1.1rem;
      font-weight: 800;
      box-shadow:
        0 0 0 3px #022c22,
        0 12px 24px rgba(34,197,94,0.6);
    }

    header p {
      margin: 4px 0 0;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .pill {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-muted);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(2,6,23,0.9);
      backdrop-filter: blur(10px);
    }

    .pill strong {
      color: var(--accent-strong);
    }

    /* --- HERO / INSTAGRAM-BEREICH --- */

    .hero {
      margin-bottom: 24px;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 2fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      .hero {
        grid-template-columns: 1fr;
      }
    }

    .hero-card {
      position: relative;
      border-radius: 20px;
      padding: 18px 18px 20px;
      background:
        radial-gradient(circle at 0% 0%, rgba(34,197,94,0.18), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(56,189,248,0.18), transparent 55%),
        #020617;
      box-shadow:
        0 0 0 2px rgba(15,23,42,1),
        0 0 0 1px rgba(51,65,85,0.8),
        0 28px 48px rgba(15,23,42,0.95);
      border: 1px solid rgba(51,65,85,0.9);
      overflow: hidden;
      isolation: isolate;
    }

    .hero-card::before {
      /* Pixel-Grid */
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 12px;
      background-image:
        linear-gradient(rgba(148,163,184,0.18) 1px, transparent 1px),
        linear-gradient(90deg, rgba(148,163,184,0.18) 1px, transparent 1px);
      background-size: 18px 18px;
      opacity: 0.4;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .hero-card::after {
      /* atmender Glow */
      content: "";
      position: absolute;
      inset: -40px;
      background: radial-gradient(circle, rgba(34,197,94,0.25) 0, transparent 55%);
      opacity: 0.4;
      mix-blend-mode: screen;
      pointer-events: none;
      animation: heroBreath 6s ease-in-out infinite;
    }

    @keyframes heroBreath {
      0% { opacity: 0.25; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.03); }
      100% { opacity: 0.25; transform: scale(1); }
    }

    .hero-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .hero-title-row {
      display: flex;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    .hero-level-number {
      font-size: 2.8rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .hero-level-number span.label {
      font-size: 0.9rem;
      letter-spacing: 0.24em;
      margin-right: 6px;
      color: var(--text-muted);
    }

    .hero-level-number span.value {
      color: var(--accent-strong);
      text-shadow:
        0 0 12px rgba(34,197,94,0.7),
        0 0 24px rgba(22,163,74,0.85);
    }

    .hero-tagline {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .hero-subrow {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 2px;
      font-size: 0.78rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .hero-subrow span {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
    }

    .hero-progress {
      margin-top: 8px;
    }

    .progress-bar-hero {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, #020617, #020617);
      border: 1px solid rgba(148,163,184,0.8);
      overflow: hidden;
      position: relative;
    }

    .progress-fill-hero {
      height: 100%;
      border-radius: 999px;
      background:
        linear-gradient(90deg, #22c55e, #bef264);
      width: 0%;
      transition: width 0.5s ease-out;
      box-shadow:
        0 0 18px rgba(34,197,94,0.85),
        0 0 26px rgba(190,242,100,0.7);
    }

    .hero-progress-meta {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
      font-family: "JetBrains Mono", ui-monospace;
    }

    .hero-progress-meta strong {
      color: var(--accent-strong);
      font-size: 0.84rem;
    }

    .hero-status-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .status-chip {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text-muted);
      background: rgba(15,23,42,0.9);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 2px;
      background: var(--accent);
      box-shadow: 0 0 6px rgba(34,197,94,0.9);
    }

    .hero-mini-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 10px;
      font-size: 0.78rem;
    }

    .hero-mini-card {
      border-radius: 10px;
      padding: 6px 8px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(30,64,175,0.7);
    }

    .hero-mini-label {
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .hero-mini-value {
      font-weight: 600;
      font-size: 0.86rem;
    }

    .hero-mini-pill {
      margin-top: 2px;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .hero-badge {
      font-size: 0.78rem;
      margin-top: 8px;
      color: var(--text-muted);
    }

    .hero-badge span {
      color: var(--accent-strong);
      font-weight: 600;
    }

    /* Rechts im Hero: kompakter 7-Tage-Level-Score (Rank) */

    .hero-summary-card {
      position: relative;
      border-radius: 20px;
      padding: 14px 14px 16px;
      background:
        radial-gradient(circle at 0% 0%, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(30,64,175,0.9);
      overflow: hidden;
    }

    .hero-summary-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(37,99,235,0.2), transparent 60%);
      mix-blend-mode: soft-light;
      opacity: 0.4;
    }

    .hero-summary-inner {
      position: relative;
      z-index: 1;
    }

    .hero-summary-title {
      font-size: 0.9rem;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .hero-score-value {
      font-size: 1.8rem;
      font-weight: 800;
      font-family: "JetBrains Mono", ui-monospace;
    }

    .hero-score-chip {
      font-size: 0.78rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-muted);
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }

    .hero-rank-pill {
      font-size: 0.8rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(250,250,250,0.4);
      background: rgba(15,23,42,0.95);
    }

    .hero-score-chip span {
      font-weight: 600;
    }

    .hero-summary-body {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .hero-summary-bars {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 4px;
      margin-top: 10px;
    }

    .hero-bar-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .hero-bar {
      width: 14px;
      height: 26px;
      border-radius: 4px;
      background: rgba(15,23,42,1);
      border: 1px solid rgba(30,64,175,0.8);
      overflow: hidden;
      display: flex;
      align-items: flex-end;
    }

    .hero-bar-fill {
      width: 100%;
      height: 0%;
      transition: height 0.35s ease-out;
      background: linear-gradient(to top, #22c55e, #4ade80);
    }

    .hero-bar-fill.warn {
      background: linear-gradient(to top, #f97316, #fdba74);
    }

    .hero-bar-fill.bad {
      background: linear-gradient(to top, #ef4444, #fca5a5);
    }

    .hero-summary-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .hero-summary-tags span {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(51,65,85,0.7);
    }

    /* --- RESTLICHES LAYOUT --- */

    .grid {
      display: grid;
      grid-template-columns: 2fr 3fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
      border: 1px solid rgba(30,64,175,0.5);
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card h2 span {
      font-size: 0.8rem;
      font-weight: 400;
      color: var(--text-muted);
    }

    .small {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid rgba(30,64,175,0.7);
      background: #020617;
      color: var(--text);
      font-size: 0.85rem;
    }

    input:focus, select:focus, textarea:focus {
      outline: 1px solid var(--accent);
      border-color: var(--accent);
    }

    textarea {
      resize: vertical;
      min-height: 40px;
      max-height: 120px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px 14px;
      margin-top: 10px;
    }

    .inline-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .inline-row input[type="checkbox"] {
      width: auto;
    }

    .btn-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-group-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 16px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
    }

    .btn-secondary {
      background: #020617;
      color: var(--text-muted);
      border: 1px solid rgba(148,163,184,0.7);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px dashed rgba(148,163,184,0.6);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .summary-card {
      border-radius: 10px;
      padding: 10px 10px;
      background: #020617;
      border: 1px solid rgba(30,64,175,0.5);
    }

    .summary-label {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .summary-value {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .tag-ok {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: var(--accent-soft);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      margin-top: 4px;
      border: 1px solid rgba(34,197,94,0.6);
    }

    .tag-warn {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: rgba(248,250,252,0.02);
      color: var(--warning);
      border: 1px solid rgba(249,115,22,0.45);
      display: inline-flex;
      align-items: center;
      margin-top: 4px;
    }

    .tag-bad {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: rgba(248,113,113,0.08);
      color: var(--danger);
      border: 1px solid rgba(248,113,113,0.6);
      display: inline-flex;
      align-items: center;
      margin-top: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.8rem;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid rgba(30,64,175,0.5);
      text-align: left;
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.7);
    }

    .table-wrapper {
      max-height: 360px;
      overflow: auto;
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid rgba(30,64,175,0.5);
      background: #020617;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      font-size: 0.75rem;
      color: var(--text-muted);
      gap: 6px;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .danger-link {
      color: var(--danger);
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.78rem;
    }

    .nowrap {
      white-space: nowrap;
    }

    #importJsonInput {
      display: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>
          <span class="logo">230</span>
          Project 230
        </h1>
        <p>Dein zentrales Dashboard für die Vorbereitung auf die TorTour de Ruhr – Training, Schlaf, Recovery & Fortschritt im Blick.</p>
      </div>
      <div>
        <div class="pill">
          <span>Ziel:</span><strong>TorTour de Ruhr 2026 · 230 km</strong>
        </div>
      </div>
    </header>

    <!-- HERO-BEREICH / SHARE-CARD -->
    <section class="hero">
      <div class="hero-card">
        <div class="hero-content">
          <div class="hero-label">Project 230 · Level</div>
          <div class="hero-title-row">
            <div class="hero-level-number">
              <span class="label">LVL</span><span class="value" id="heroLevelNumber">–</span>
            </div>
            <div class="hero-tagline" id="heroLevelTagline">Vorbereitung wird geladen …</div>
          </div>
          <div class="hero-subrow">
            <span>CLASS: ULTRARUNNER</span>
            <span>QUEST: 230 KM</span>
          </div>

          <div class="hero-progress">
            <div class="progress-bar-hero">
              <div class="progress-fill-hero" id="heroProgressFill"></div>
            </div>
            <div class="hero-progress-meta">
              <span id="heroXPText">XP: –</span>
              <span id="heroNextLevelText">bis nächstes Level</span>
            </div>
          </div>

          <div class="hero-status-tags">
            <div class="status-chip">
              <span class="status-dot"></span>
              <span id="heroStatusText">Status wird berechnet …</span>
            </div>
          </div>

          <div class="hero-mini-grid">
            <div class="hero-mini-card">
              <div class="hero-mini-label">Ø Schlaf (7T)</div>
              <div class="hero-mini-value" id="heroMiniSleep">–</div>
              <div class="hero-mini-pill">h / Tag</div>
            </div>
            <div class="hero-mini-card">
              <div class="hero-mini-label">Wochen-km (7T)</div>
              <div class="hero-mini-value" id="heroMiniKm">–</div>
              <div class="hero-mini-pill">km</div>
            </div>
            <div class="hero-mini-card">
              <div class="hero-mini-label">Hydration (7T)</div>
              <div class="hero-mini-value" id="heroMiniFluids">–</div>
              <div class="hero-mini-pill">Ø L / Tag</div>
            </div>
          </div>

          <div class="hero-badge">
            Levelziel: <span>100</span> = Mindestanforderung für die TorTour-Vorbereitung.
          </div>
        </div>
      </div>

      <div class="hero-summary-card">
        <div class="hero-summary-inner">
          <div class="hero-summary-title">
            <div>Letzte 7 Tage</div>
            <div class="hero-score-value" id="heroScoreValue">–</div>
          </div>
          <div class="hero-score-chip" id="heroScoreChip">
            <span class="hero-rank-pill" id="heroRankPill">RANK –</span>
            <span>Status: –</span>
          </div>
          <div class="hero-summary-body" id="heroSummaryBody">
            Auswertung folgt, sobald ausreichend Daten vorhanden sind.
          </div>

          <div class="hero-summary-bars">
            <div class="hero-bar-col">
              <div class="hero-bar">
                <div class="hero-bar-fill" id="heroBarTraining"></div>
              </div>
              <div>Train.</div>
            </div>
            <div class="hero-bar-col">
              <div class="hero-bar">
                <div class="hero-bar-fill" id="heroBarSleep"></div>
              </div>
              <div>Schlaf</div>
            </div>
            <div class="hero-bar-col">
              <div class="hero-bar">
                <div class="hero-bar-fill" id="heroBarFluids"></div>
              </div>
              <div>Flüss.</div>
            </div>
            <div class="hero-bar-col">
              <div class="hero-bar">
                <div class="hero-bar-fill" id="heroBarWeight"></div>
              </div>
              <div>Gew.</div>
            </div>
            <div class="hero-bar-col">
              <div class="hero-bar">
                <div class="hero-bar-fill" id="heroBarLoad"></div>
              </div>
              <div>Load</div>
            </div>
          </div>

          <div class="hero-summary-tags" id="heroSummaryTags">
            <!-- Tags per JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- Einstellungen & Check-in -->
    <div class="grid">
      <section class="card">
        <h2>Projekt-Einstellungen <span>Renn-Datum · Zielbereiche · Backup</span></h2>
        <p class="small">
          Renn-Datum & Zielbereiche setzen, optional regelmäßige Backups anlegen (JSON/CSV).
        </p>
        <div class="settings-grid">
          <div>
            <label for="raceDate">Renn-Datum (TorTour de Ruhr)</label>
            <input type="date" id="raceDate" />
          </div>
          <div>
            <label for="targetKm">Ziel-Wochenkilometer</label>
            <input type="number" id="targetKm" min="0" step="1" placeholder="Standard: 90" />
          </div>
          <div>
            <label for="targetSleep">Ziel-Schlaf (Ø h / Tag)</label>
            <input type="number" id="targetSleep" min="0" step="0.1" placeholder="z.B. 7.5" />
          </div>
          <div>
            <label for="targetFluids">Ziel-Flüssigkeit (Ø L / Tag)</label>
            <input type="number" id="targetFluids" min="0" step="0.1" placeholder="z.B. 2.5" />
          </div>
        </div>

        <div class="btn-row" style="margin-top: 10px;">
          <div class="btn-group-right">
            <button class="btn-secondary" id="saveSettingsBtn">Einstellungen speichern</button>
          </div>
          <div class="btn-group-right">
            <button class="btn-ghost" id="exportJsonBtn">Backup exportieren (JSON)</button>
            <button class="btn-ghost" id="exportCsvBtn">Daten exportieren (CSV)</button>
            <button class="btn-ghost" id="importJsonBtn">Backup importieren</button>
            <input type="file" id="importJsonInput" accept="application/json" />
          </div>
        </div>

        <div class="summary-grid" id="raceSummary">
          <!-- per JS -->
        </div>
        <p class="hint">
          Hinweis: Alle Daten liegen im Browser (<code>localStorage</code>). JSON-Backup zusätzlich speichern = sicher.
        </p>
      </section>

      <section class="card">
        <h2>Neuen Tag eintragen <span>Daily Log</span></h2>
        <p class="small">Kurz ausfüllen – der Coach evaluiert, berechnet Level & gibt Empfehlungen.</p>

        <div class="form-grid">
          <div>
            <label for="entryDate">Datum</label>
            <input type="date" id="entryDate" />
          </div>

          <div>
            <label for="weight">Gewicht (kg)</label>
            <input type="number" id="weight" step="0.1" min="0" />
          </div>

          <div>
            <label for="trainingType">Training (Art)</label>
            <select id="trainingType">
              <option value="">– Kein Training / Rest –</option>
              <option value="Langer Lauf">Langer Lauf</option>
              <option value="Intervall">Intervall</option>
              <option value="Tempo">Tempolauf</option>
              <option value="Locker">Lockerer Lauf</option>
              <option value="Kraft">Kraft / Stabi</option>
              <option value="Cross">Cross / Alternativ</option>
              <option value="Wettkampf">Wettkampf / Test</option>
            </select>
          </div>

          <div>
            <label for="distanceKm">Distanz (km)</label>
            <input type="number" id="distanceKm" step="0.1" min="0" />
          </div>

          <div>
            <label for="durationMin">Dauer (Minuten)</label>
            <input type="number" id="durationMin" step="1" min="0" />
          </div>

          <div>
            <label for="rpe">Belastung (RPE 1–10)</label>
            <input type="number" id="rpe" step="1" min="1" max="10" />
          </div>

          <div>
            <label for="sleepHours">Schlaf (Stunden)</label>
            <input type="number" id="sleepHours" step="0.1" min="0" />
          </div>

          <div>
            <label for="sleepQuality">Schlaf-Qualität</label>
            <select id="sleepQuality">
              <option value="">–</option>
              <option value="sehr gut">sehr gut</option>
              <option value="gut">gut</option>
              <option value="okay">okay</option>
              <option value="schlecht">schlecht</option>
            </select>
          </div>

          <div>
            <label for="fluidsLiters">Flüssigkeit (L)</label>
            <input type="number" id="fluidsLiters" step="0.1" min="0" />
          </div>

          <div>
            <label for="wellbeing">Wohlbefinden (1 = mies, 5 = top)</label>
            <select id="wellbeing">
              <option value="">–</option>
              <option value="1">1 – sehr schlecht</option>
              <option value="2">2</option>
              <option value="3">3 – neutral</option>
              <option value="4">4</option>
              <option value="5">5 – sehr gut</option>
            </select>
          </div>

          <div>
            <label>&nbsp;</label>
            <div class="inline-row">
              <input type="checkbox" id="nightRun" />
              <span>Nachtlauf</span>
            </div>
            <div class="inline-row">
              <input type="checkbox" id="hasPain" />
              <span>Schmerzen heute?</span>
            </div>
          </div>

          <div style="grid-column: 1 / -1;">
            <label for="painNote">Schmerz / Beschwerden (optional)</label>
            <textarea id="painNote" placeholder="z.B. Knie, Achillessehne, Magen, mental müde …"></textarea>
          </div>

          <div style="grid-column: 1 / -1;">
            <label for="comments">Weitere Notizen</label>
            <textarea id="comments" placeholder="Was lief gut? Was war schwer? Was möchtest du festhalten?"></textarea>
          </div>
        </div>

        <div class="btn-row">
          <span class="hint">
            Alles bleibt lokal im Browser gespeichert.
            <span class="danger-link" id="clearDataLink">Alle Daten löschen</span>
          </span>
          <div class="btn-group-right">
            <button class="btn-secondary" id="fillTodayBtn">Heute übernehmen</button>
            <button class="btn-primary" id="addEntryBtn">Eintrag speichern</button>
          </div>
        </div>
      </section>
    </div>

    <!-- Auswertung 7 Tage -->
    <section class="card">
      <h2>Auswertung letzte 7 Tage <span>Training · Schlaf · Flüssigkeit · Details</span></h2>

      <div class="summary-grid" id="statsSummary">
        <!-- per JS -->
      </div>

      <p class="hint">
        Ziel: stabile Wochenstruktur, gute Regeneration und kontinuierlicher Aufbau Richtung Level&nbsp;100 (TorTour-Ready).
      </p>
      <div id="coachFeedback" class="hint"></div>
    </section>

    <!-- Coaching-Empfehlungen -->
    <section class="card" style="margin-top:20px;">
      <h2>Coach-Empfehlungen <span>Tages- & Wochenfokus</span></h2>
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">Empfehlung für morgen</div>
          <div class="summary-value" id="dailyCoachTitle">Wird aus deinen Daten berechnet …</div>
          <div class="coach-text" id="dailyCoachText"></div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Wochen-Coaching</div>
          <div class="summary-value" id="weeklyCoachTitle">Wochenplan basierend auf letzter Woche</div>
          <div class="coach-text" id="weeklyCoachText"></div>
        </div>
      </div>
      <p class="hint">
        Berechnung basiert auf Wochenkilometern, Belastung (TRIMP), Schlaf, Flüssigkeit, Wohlbefinden & Beschwerden.
      </p>
    </section>

    <!-- Rohdaten -->
    <section class="card" style="margin-top: 20px;">
      <h2>Alle Einträge <span>Rohdaten</span></h2>
      <div class="chip" style="margin-bottom: 6px;">
        <span class="chip-dot"></span>
        <span>Grundlage für Auswertung, Level & Coaching</span>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Datum</th>
              <th>Gewicht</th>
              <th>Training</th>
              <th>km</th>
              <th>Dauer</th>
              <th>RPE</th>
              <th>Schlaf (h)</th>
              <th>Flüssigkeit (L)</th>
              <th>Wohlbef.</th>
              <th>Nacht?</th>
              <th>Schmerz?</th>
              <th>Schmerz-Notiz</th>
              <th>Weitere Notizen</th>
            </tr>
          </thead>
          <tbody id="entriesTableBody">
            <!-- per JS -->
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    // --- Helper ---
    function parseNumber(value) {
      if (value === null || value === undefined) return null;
      const v = String(value).replace(',', '.').trim();
      if (v === '') return null;
      const num = parseFloat(v);
      return isNaN(num) ? null : num;
    }

    function saveState(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    function loadState(key, fallback) {
      const raw = localStorage.getItem(key);
      if (!raw) return fallback;
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.warn('Konnte State nicht lesen:', key, e);
        return fallback;
      }
    }

    const STORAGE_ENTRIES_KEY = "project230_entries_v1";
    const STORAGE_SETTINGS_KEY = "project230_settings_v1";

    let entries = loadState(STORAGE_ENTRIES_KEY, []);
    let settings = loadState(STORAGE_SETTINGS_KEY, {
      raceDate: "",
      targetKm: 90,
      targetSleep: 7.5,
      targetFluids: 2.5
    });

    // --- DOM ---
    const raceDateInput = document.getElementById("raceDate");
    const targetKmInput = document.getElementById("targetKm");
    const targetSleepInput = document.getElementById("targetSleep");
    const targetFluidsInput = document.getElementById("targetFluids");
    const raceSummaryEl = document.getElementById("raceSummary");

    const entryDateInput = document.getElementById("entryDate");
    const weightInput = document.getElementById("weight");
    const trainingTypeInput = document.getElementById("trainingType");
    const distanceKmInput = document.getElementById("distanceKm");
    const durationMinInput = document.getElementById("durationMin");
    const rpeInput = document.getElementById("rpe");
    const sleepHoursInput = document.getElementById("sleepHours");
    const sleepQualityInput = document.getElementById("sleepQuality");
    const fluidsLitersInput = document.getElementById("fluidsLiters");
    const wellbeingInput = document.getElementById("wellbeing");
    const nightRunInput = document.getElementById("nightRun");
    const hasPainInput = document.getElementById("hasPain");
    const painNoteInput = document.getElementById("painNote");
    const commentsInput = document.getElementById("comments");

    const saveSettingsBtn = document.getElementById("saveSettingsBtn");
    const fillTodayBtn = document.getElementById("fillTodayBtn");
    const addEntryBtn = document.getElementById("addEntryBtn");
    const clearDataLink = document.getElementById("clearDataLink");

    const exportJsonBtn = document.getElementById("exportJsonBtn");
    const exportCsvBtn = document.getElementById("exportCsvBtn");
    const importJsonBtn = document.getElementById("importJsonBtn");
    const importJsonInput = document.getElementById("importJsonInput");

    const statsSummaryEl = document.getElementById("statsSummary");
    const entriesTableBody = document.getElementById("entriesTableBody");
    const coachFeedbackEl = document.getElementById("coachFeedback");

    const dailyCoachTitleEl = document.getElementById("dailyCoachTitle");
    const dailyCoachTextEl = document.getElementById("dailyCoachText");
    const weeklyCoachTitleEl = document.getElementById("weeklyCoachTitle");
    const weeklyCoachTextEl = document.getElementById("weeklyCoachText");

    // HERO-Elemente
    const heroLevelNumberEl = document.getElementById("heroLevelNumber");
    const heroLevelTaglineEl = document.getElementById("heroLevelTagline");
    const heroProgressFillEl = document.getElementById("heroProgressFill");
    const heroXPTextEl = document.getElementById("heroXPText");
    const heroNextLevelTextEl = document.getElementById("heroNextLevelText");
    const heroStatusTextEl = document.getElementById("heroStatusText");
    const heroMiniSleepEl = document.getElementById("heroMiniSleep");
    const heroMiniKmEl = document.getElementById("heroMiniKm");
    const heroMiniFluidsEl = document.getElementById("heroMiniFluids");
    const heroScoreValueEl = document.getElementById("heroScoreValue");
    const heroScoreChipEl = document.getElementById("heroScoreChip");
    const heroRankPillEl = document.getElementById("heroRankPill");
    const heroSummaryBodyEl = document.getElementById("heroSummaryBody");
    const heroSummaryTagsEl = document.getElementById("heroSummaryTags");

    const heroBarTrainingEl = document.getElementById("heroBarTraining");
    const heroBarSleepEl = document.getElementById("heroBarSleep");
    const heroBarFluidsEl = document.getElementById("heroBarFluids");
    const heroBarWeightEl = document.getElementById("heroBarWeight");
    const heroBarLoadEl = document.getElementById("heroBarLoad");

    // --- Settings UI ---
    function initSettingsUI() {
      if (settings.raceDate) raceDateInput.value = settings.raceDate;
      if (settings.targetKm != null) targetKmInput.value = settings.targetKm;
      if (settings.targetSleep != null) targetSleepInput.value = settings.targetSleep;
      if (settings.targetFluids != null) targetFluidsInput.value = settings.targetFluids;
    }

    function saveSettings() {
      settings.raceDate = raceDateInput.value || "";
      settings.targetKm = parseNumber(targetKmInput.value) ?? 90;
      settings.targetSleep = parseNumber(targetSleepInput.value) ?? 7.5;
      settings.targetFluids = parseNumber(targetFluidsInput.value) ?? 2.5;

      saveState(STORAGE_SETTINGS_KEY, settings);
      updateRaceSummary();
      updateStats();
    }

    function updateRaceSummary() {
      raceSummaryEl.innerHTML = "";

      const today = new Date();
      today.setHours(0,0,0,0);

      const raceDateStr = settings.raceDate;
      let blocks = "";

      if (raceDateStr) {
        const raceDate = new Date(raceDateStr + "T00:00:00");
        const diffMs = raceDate.getTime() - today.getTime();
        const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));

        let statusText = "";
        let tagClass = "tag-ok";

        if (diffDays > 0) {
          statusText = diffDays + " Tage bis zur TorTour";
          if (diffDays < 30) {
            tagClass = "tag-warn";
          } else if (diffDays < 7) {
            tagClass = "tag-bad";
            statusText = "Race Week – " + diffDays + " Tage";
          }
        } else if (diffDays === 0) {
          statusText = "HEUTE ist TorTour-Day!";
          tagClass = "tag-bad";
        } else {
          statusText = "Rennen liegt " + Math.abs(diffDays) + " Tage zurück";
          tagClass = "tag-warn";
        }

        blocks += `
          <div class="summary-card">
            <div class="summary-label">Race-Countdown</div>
            <div class="summary-value">${statusText}</div>
            <div class="${tagClass}">Renn-Datum: ${raceDate.toLocaleDateString("de-DE")}</div>
          </div>
        `;
      } else {
        blocks += `
          <div class="summary-card">
            <div class="summary-label">Race-Countdown</div>
            <div class="summary-value">Noch kein Datum gesetzt</div>
            <div class="tag-warn">Trage das Renn-Datum ein, um den Countdown zu aktivieren.</div>
          </div>
        `;
      }

      blocks += `
        <div class="summary-card">
          <div class="summary-label">Ziel-Wochenkilometer</div>
          <div class="summary-value">${settings.targetKm != null ? settings.targetKm + " km" : "90 km (Standard)"}</div>
          <div class="tag-ok">Solider Ultra-Bereich für die TorTour-Basis.</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Ziel-Schlaf</div>
          <div class="summary-value">${settings.targetSleep != null ? settings.targetSleep + " h / Tag" : "7.5 h / Tag"}</div>
          <div class="tag-ok">Schlaf als zentrales Recovery-Element.</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Ziel-Flüssigkeit</div>
          <div class="summary-value">${settings.targetFluids != null ? settings.targetFluids + " L / Tag" : "2.5 L / Tag"}</div>
          <div class="tag-ok">Hydration als Grundlage für lange Einheiten.</div>
        </div>
      `;

      raceSummaryEl.innerHTML = blocks;
    }

    function formatDateShort(dateString) {
      const d = new Date(dateString + "T00:00:00");
      return d.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });
    }

    // --- Level / XP-Berechnung ---
    function computeDailyXP(entry, settings) {
      const targetKm = settings.targetKm || 90;
      const targetSleep = settings.targetSleep || 7.5;
      const targetFluids = settings.targetFluids || 2.5;

      let xp = 0;

      const dist = parseNumber(entry.distanceKm);
      const dur = parseNumber(entry.durationMin);
      const rpe = parseNumber(entry.rpe);
      const sleep = parseNumber(entry.sleepHours);
      const fluids = parseNumber(entry.fluidsLiters);
      const wb = parseNumber(entry.wellbeing);
      const isTraining = dist != null && dist > 0 && dur != null && dur > 0;

      if (isTraining) {
        xp += 10;
      } else {
        xp += 3; // Restday zählt auch
      }

      if (dist != null && dist > 0 && targetKm > 0) {
        const targetDailyKm = targetKm / 7;
        const ratio = dist / targetDailyKm;
        if (ratio >= 0.8 && ratio <= 1.5) {
          xp += 10;
        } else if (ratio > 0.3) {
          xp += 5;
        } else {
          xp += 2;
        }
      }

      if (sleep != null) {
        const ratio = sleep / targetSleep;
        if (ratio >= 0.95) xp += 6;
        else if (ratio >= 0.8) xp += 4;
        else if (ratio >= 0.6) xp += 2;
      }

      if (fluids != null) {
        const ratio = fluids / targetFluids;
        if (ratio >= 0.95) xp += 5;
        else if (ratio >= 0.8) xp += 3;
        else if (ratio >= 0.6) xp += 1;
      }

      if (wb != null) {
        if (wb >= 4) xp += 3;
        else if (wb === 3) xp += 2;
        else if (wb <= 2) xp += 1;
      }

      if (entry.nightRun) {
        xp += 8;
      }
      if (entry.trainingType === "Langer Lauf" && dist != null && dist >= 25) {
        xp += 8;
      }

      if (dur != null && rpe != null && dur >= 60 && rpe >= 8) {
        xp += 5;
      }

      if (xp < 3) xp = 3;
      if (xp > 35) xp = 35;

      return xp;
    }

    function computeTotalXP(entries, settings) {
      let total = 0;
      for (const e of entries) {
        if (!e.date) continue;
        total += computeDailyXP(e, settings);
      }
      return Math.round(total);
    }

    function getLevelFromXP(totalXP) {
      const maxLevel = 100;
      const xpPerLevel = 50;
      let level = Math.floor(totalXP / xpPerLevel) + 1;
      if (level > maxLevel) level = maxLevel;
      const currLevelXp = (level - 1) * xpPerLevel;
      const nextLevelXp = level < maxLevel ? level * xpPerLevel : currLevelXp;
      const xpIntoLevel = totalXP - currLevelXp;
      return { level, currLevelXp, nextLevelXp, xpIntoLevel, xpPerLevel };
    }

    // --- Export / Import ---
    function exportJSON() {
      const data = {
        version: 1,
        exportedAt: new Date().toISOString(),
        settings,
        entries
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dateStr = new Date().toISOString().slice(0,10);
      a.href = url;
      a.download = `project230_backup_${dateStr}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function exportCSV() {
      if (!entries || entries.length === 0) {
        alert("Keine Einträge vorhanden, die exportiert werden könnten.");
        return;
      }
      const header = [
        "date","weight","trainingType","distanceKm","durationMin","rpe",
        "sleepHours","sleepQuality","fluidsLiters","wellbeing",
        "nightRun","hasPain","painNote","comments"
      ];
      const rows = [header];

      for (const e of entries) {
        rows.push([
          e.date || "",
          e.weight != null ? e.weight : "",
          e.trainingType || "",
          e.distanceKm != null ? e.distanceKm : "",
          e.durationMin != null ? e.durationMin : "",
          e.rpe != null ? e.rpe : "",
          e.sleepHours != null ? e.sleepHours : "",
          e.sleepQuality || "",
          e.fluidsLiters != null ? e.fluidsLiters : "",
          e.wellbeing != null ? e.wellbeing : "",
          e.nightRun ? "1" : "0",
          e.hasPain ? "1" : "0",
          (e.painNote || "").replace(/"/g, '""'),
          (e.comments || "").replace(/"/g, '""')
        ]);
      }

      const csvContent = rows.map(r =>
        r.map(cell => {
          const str = String(cell);
          if (str.includes(",") || str.includes("\"") || str.includes("\n")) {
            return `"${str.replace(/"/g, '""')}"`;
          }
          return str;
        }).join(",")
      ).join("\n");

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dateStr = new Date().toISOString().slice(0,10);
      a.href = url;
      a.download = `project230_entries_${dateStr}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function triggerImport() {
      importJsonInput.value = "";
      importJsonInput.click();
    }

    function handleImportFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(ev) {
        try {
          const text = ev.target.result;
          const data = JSON.parse(text);

          if (!data || (!Array.isArray(data.entries) && !Array.isArray(data))) {
            alert("Die JSON-Datei enthält kein erwartetes Format.");
            return;
          }

          let importedEntries;
          let importedSettings;

          if (Array.isArray(data)) {
            importedEntries = data;
            importedSettings = settings;
          } else {
            importedEntries = Array.isArray(data.entries) ? data.entries : [];
            importedSettings = data.settings || settings;
          }

          if (!confirm(`Backup mit ${importedEntries.length} Einträgen laden und bestehende Daten überschreiben?`)) {
            return;
          }

          entries = importedEntries;
          settings = {
            raceDate: importedSettings.raceDate || "",
            targetKm: importedSettings.targetKm ?? settings.targetKm ?? 90,
            targetSleep: importedSettings.targetSleep ?? settings.targetSleep ?? 7.5,
            targetFluids: importedSettings.targetFluids ?? settings.targetFluids ?? 2.5
          };

          saveState(STORAGE_ENTRIES_KEY, entries);
          saveState(STORAGE_SETTINGS_KEY, settings);

          initSettingsUI();
          updateRaceSummary();
          updateStats();
          alert("Backup erfolgreich importiert.");
        } catch (err) {
          console.error("Fehler beim Import:", err);
          alert("Fehler beim Import der JSON-Datei. Bitte prüfen, ob es ein gültiges Backup ist.");
        }
      };
      reader.readAsText(file);
    }

    // --- Stats, Score & Coaching ---
    function updateStats() {
      statsSummaryEl.innerHTML = "";
      if (coachFeedbackEl) coachFeedbackEl.textContent = "";

      if (!entries || entries.length === 0) {
        statsSummaryEl.innerHTML = `
          <div class="summary-card">
            <div class="summary-label">Noch keine Daten</div>
            <div class="summary-value">Starte mit deinem ersten Eintrag.</div>
            <div class="tag-warn">Ein paar Tage loggen, dann gibt es Score, Level & Coaching.</div>
          </div>
        `;
        entriesTableBody.innerHTML = "";
        updateCoaching({}, {});
        updateHero({}, {}, {}, {});
        return;
      }

      const sorted = [...entries].sort((a, b) => (a.date || "").localeCompare(b.date || ""));

      const today = new Date();
      today.setHours(0,0,0,0);
      const sevenDaysAgo = new Date(today.getTime() - 6 * 24*60*60*1000);
      const threeDaysAgo = new Date(today.getTime() - 2 * 24*60*60*1000);
      const thirtyDaysAgo = new Date(today.getTime() - 30 * 24*60*60*1000);
      const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().substring(0,10);

      let sumKm = 0;
      let sumSleep = 0;
      let sumFluids = 0;
      let countSleep = 0;
      let countFluids = 0;

      let trimp7 = 0;
      let trimp3 = 0;

      let latestWeight = null;
      let weight30days = null;
      let last7WellbeingSum = 0;
      let last7WellbeingCount = 0;
      let painCountLast7 = 0;

      for (const e of sorted) {
        if (!e.date) continue;
        const d = new Date(e.date + "T00:00:00");
        const dateStr = e.date;

        if (d >= sevenDaysAgo && d <= today) {
          const dist = parseNumber(e.distanceKm);
          if (dist != null) sumKm += dist;

          const sleep = parseNumber(e.sleepHours);
          if (sleep != null) { sumSleep += sleep; countSleep++; }

          const fluids = parseNumber(e.fluidsLiters);
          if (fluids != null) { sumFluids += fluids; countFluids++; }

          const wb = parseNumber(e.wellbeing);
          if (wb != null) { last7WellbeingSum += wb; last7WellbeingCount++; }

          if (e.hasPain === true) painCountLast7++;
        }

        const dur = parseNumber(e.durationMin);
        const rpeVal = parseNumber(e.rpe);
        let trimp = 0;
        if (dur != null && rpeVal != null) {
          trimp = dur * rpeVal;
        }
        if (d >= sevenDaysAgo && d <= today) trimp7 += trimp;
        if (d >= threeDaysAgo && d <= today) trimp3 += trimp;

        const w = parseNumber(e.weight);
        if (w != null) {
          if (!latestWeight || e.date > latestWeight.date) {
            latestWeight = { date: e.date, weight: w };
          }
          if (e.date <= thirtyDaysAgoStr) {
            if (!weight30days || e.date > weight30days.date) {
              weight30days = { date: e.date, weight: w };
            }
          }
        }
      }

      const avgSleep = countSleep > 0 ? (sumSleep / countSleep) : null;
      const avgFluids = countFluids > 0 ? (sumFluids / countFluids) : null;
      const avgWellbeing = last7WellbeingCount > 0 ? last7WellbeingSum / last7WellbeingCount : null;

      function buildTag(current, target, unit, direction = "higher-better") {
        if (target == null || current == null) {
          return '<div class="tag-warn">Noch zu wenige Daten oder kein Ziel gesetzt.</div>';
        }
        let diff = current - target;
        const diffAbs = Math.abs(diff).toFixed(1);

        if (direction === "higher-better") {
          if (current >= target * 0.95 && current <= target * 1.1) {
            return `<div class="tag-ok">Sehr nah am Ziel (${diff >= 0 ? "+" : "–"}${diffAbs} ${unit})</div>`;
          } else if (current >= target * 0.7) {
            return `<div class="tag-warn">Okay, aber noch Luft nach oben (${diff >= 0 ? "+" : "–"}${diffAbs} ${unit})</div>`;
          } else {
            return `<div class="tag-bad">Deutlich unter Ziel (${diff >= 0 ? "+" : "–"}${diffAbs} ${unit})</div>`;
          }
        } else {
          if (current <= target * 1.05) {
            return `<div class="tag-ok">Im Zielbereich (${diff >= 0 ? "+" : "–"}${diffAbs} ${unit})</div>`;
          } else if (current <= target * 1.2) {
            return `<div class="tag-warn">Etwas drüber (${diffAbs} ${unit}) – beobachten.</div>`;
          } else {
            return `<div class="tag-bad">Deutlich drüber (${diffAbs} ${unit}) – Belastung prüfen.</div>`;
          }
        }
      }

      function levelFromScore(score) {
        if (score >= 80) return { label: "Grün", className: "tag-ok" };
        if (score >= 60) return { label: "Gelb", className: "tag-warn" };
        return { label: "Rot", className: "tag-bad" };
      }

      let kmScore = 50;
      let sleepScore = 50;
      let fluidsScore = 50;
      let weightScore = 50;
      let loadScore = 50;

      const targetKm = settings.targetKm || 90;

      if (targetKm > 0 && sumKm > 0) {
        const ratio = sumKm / targetKm;
        if (ratio >= 0.8 && ratio <= 1.1) kmScore = 90;
        else if (ratio >= 0.6 && ratio <= 1.3) kmScore = 75;
        else if (ratio >= 0.4 && ratio <= 1.6) kmScore = 55;
        else kmScore = 35;
      } else if (sumKm > 0) {
        kmScore = 70;
      }

      const targetSleep = settings.targetSleep || 7.5;
      if (avgSleep != null) {
        const ratio = avgSleep / targetSleep;
        if (ratio >= 0.95 && ratio <= 1.1) sleepScore = 90;
        else if (ratio >= 0.8 && ratio <= 1.2) sleepScore = 75;
        else if (ratio >= 0.6 && ratio <= 1.4) sleepScore = 55;
        else sleepScore = 35;
      }

      const targetFluids = settings.targetFluids || 2.5;
      if (avgFluids != null) {
        const ratio = avgFluids / targetFluids;
        if (ratio >= 0.95 && ratio <= 1.1) fluidsScore = 90;
        else if (ratio >= 0.8 && ratio <= 1.2) fluidsScore = 75;
        else if (ratio >= 0.6 && ratio <= 1.4) fluidsScore = 55;
        else fluidsScore = 35;
      }

      if (latestWeight && weight30days) {
        const diff = latestWeight.weight - weight30days.weight;
        const diffAbs = Math.abs(diff);
        if (diffAbs < 0.5) weightScore = 90;
        else if (diffAbs < 1.5) weightScore = 75;
        else if (diffAbs < 3) weightScore = 55;
        else weightScore = 35;
      } else if (latestWeight && !weight30days) {
        weightScore = 65;
      }

      if (trimp7 > 0) {
        const ratio = trimp3 / trimp7;
        if (ratio >= 0.35 && ratio <= 0.55) loadScore = 90;
        else if (ratio >= 0.25 && ratio <= 0.65) loadScore = 75;
        else if (ratio >= 0.15 && ratio <= 0.75) loadScore = 55;
        else loadScore = 35;
      }

      const overallScore = Math.round(
        kmScore * 0.4 +
        sleepScore * 0.25 +
        fluidsScore * 0.15 +
        weightScore * 0.1 +
        loadScore * 0.1
      );

      let overallText = "";
      if (overallScore >= 85) {
        overallText = "Sehr gut im Plan – Vorbereitung wirkt stabil und durchdacht.";
      } else if (overallScore >= 70) {
        overallText = "Gut unterwegs – ein paar Stellschrauben (Schlaf/Struktur) verbessern die Stabilität weiter.";
      } else if (overallScore >= 55) {
        overallText = "Solide Basis, aber noch nicht richtig stabil. Fokus auf Routine, Recovery & klare Wochenstruktur.";
      } else {
        overallText = "Achtung: Vorbereitung wirkt wackelig. Umfang, Schlaf & Hydration bewusst prüfen und ggf. anpassen.";
      }

      const kmLevel = levelFromScore(kmScore);
      const sleepLevel = levelFromScore(sleepScore);
      const fluidsLevel = levelFromScore(fluidsScore);
      const weightLevel = levelFromScore(weightScore);
      const loadLevel = levelFromScore(loadScore);

      const totalXP = computeTotalXP(sorted, settings);
      const progress = getLevelFromXP(totalXP);
      const levelPercent = progress.xpPerLevel > 0
        ? Math.min(100, Math.max(0, (progress.xpIntoLevel / progress.xpPerLevel) * 100))
        : 0;

      let summaryHtml = "";

      summaryHtml += `
        <div class="summary-card">
          <div class="summary-label">Wochenkilometer (letzte 7 Tage)</div>
          <div class="summary-value">${sumKm.toFixed(1)} km</div>
          ${buildTag(sumKm, targetKm, "km/Woche", "higher-better")}
        </div>
      `;

      summaryHtml += `
        <div class="summary-card">
          <div class="summary-label">Ø Schlaf (letzte 7 Tage)</div>
          <div class="summary-value">${avgSleep != null ? avgSleep.toFixed(2) + " h" : "–"}</div>
          ${buildTag(avgSleep, targetSleep, "h/Tag", "higher-better")}
        </div>
      `;

      summaryHtml += `
        <div class="summary-card">
          <div class="summary-label">Ø Flüssigkeit (letzte 7 Tage)</div>
          <div class="summary-value">${avgFluids != null ? avgFluids.toFixed(2) + " L" : "–"}</div>
          ${buildTag(avgFluids, targetFluids, "L/Tag", "higher-better")}
        </div>
      `;

      let weightLine = "–";
      let trendTag = '<div class="tag-warn">Noch zu wenige Daten für einen Trend.</div>';

      if (latestWeight) {
        weightLine = latestWeight.weight.toFixed(1) + " kg";
        if (weight30days) {
          const diff = latestWeight.weight - weight30days.weight;
          const diffAbs = Math.abs(diff).toFixed(1);

          if (Math.abs(diff) < 0.5) {
            trendTag = `<div class="tag-ok">Gewicht stabil (±${diffAbs} kg in 30 Tagen)</div>`;
          } else if (diff < 0) {
            trendTag = `<div class="tag-warn">Gewichtsabnahme (${diffAbs} kg in 30 Tagen) – passt das zu deinem Plan?</div>`;
          } else {
            trendTag = `<div class="tag-warn">Gewichtszunahme (${diffAbs} kg in 30 Tagen) – bewusst so geplant?</div>`;
          }
        }
      }

      summaryHtml += `
        <div class="summary-card">
          <div class="summary-label">Aktuelles Gewicht</div>
          <div class="summary-value">${weightLine}</div>
          ${trendTag}
        </div>
      `;

      statsSummaryEl.innerHTML = summaryHtml;

      // Coach-Fazit
      if (coachFeedbackEl) {
        const hints = [];

        if (kmScore < 60) hints.push("Trainingsumfang langsam, aber stetig steigern (max. ~10 % mehr Wochen-km als in der Vorwoche).");
        else if (kmScore >= 80) hints.push("Training: Wochenkilometer liegen gut im Zielbereich – Konstanz ist entscheidend.");

        if (sleepScore < 60) hints.push("Schlaf: 1–2 Abende bewusst früher ins Bett, vor allem nach langen oder intensiven Einheiten.");
        else if (sleepScore >= 80) hints.push("Schlaf: Erholung sieht stark aus – sehr gute Grundlage.");

        if (fluidsScore < 60) hints.push("Hydration: Trinkmenge leicht erhöhen (z.B. +0,5 L/Tag), besonders an langen Lauftagen.");
        else if (fluidsScore >= 80) hints.push("Hydration: Flüssigkeitszufuhr wirkt stabil.");

        if (weightScore < 60 && latestWeight && weight30days) {
          hints.push("Gewichtstrend auffällig – Energiezufuhr vs. Trainingsbelastung bewusst checken.");
        }

        if (loadScore < 60 && trimp7 > 0) {
          hints.push("Belastung: nicht zu viele harte Tage nacheinander – maximal 2 sehr intensive Tage in 3 Tagen.");
        }

        if (avgWellbeing != null && avgWellbeing <= 2.5) {
          hints.push("Wohlbefinden eher niedrig – ggf. Stress, Schlaf und Umfang etwas reduzieren.");
        }

        if (painCountLast7 >= 3) {
          hints.push("Mehrere Tage mit Schmerzen – Umfang/Intensität anpassen, ggf. ärztliche/physiotherapeutische Abklärung im Hinterkopf behalten.");
        }

        const feedbackText = `
          <strong>Coach-Fazit:</strong> ${overallText}<br>
          ${hints.length > 0 ? hints.map(h => "• " + h).join("<br>") : "• Aktuell kein akuter Handlungsbedarf – sauber weiter dokumentieren und auf den Körper hören."}
        `;
        coachFeedbackEl.innerHTML = feedbackText;
      }

      // Tabelle
      let rowsHtml = "";
      for (const e of sorted) {
        rowsHtml += `
          <tr>
            <td class="nowrap">${e.date || ""}</td>
            <td>${e.weight != null ? e.weight : ""}</td>
            <td>${e.trainingType || ""}</td>
            <td>${e.distanceKm != null ? e.distanceKm : ""}</td>
            <td>${e.durationMin != null ? e.durationMin : ""}</td>
            <td>${e.rpe != null ? e.rpe : ""}</td>
            <td>${e.sleepHours != null ? e.sleepHours : ""}</td>
            <td>${e.fluidsLiters != null ? e.fluidsLiters : ""}</td>
            <td>${e.wellbeing != null ? e.wellbeing : ""}</td>
            <td>${e.nightRun ? "Ja" : ""}</td>
            <td>${e.hasPain ? "Ja" : ""}</td>
            <td>${e.painNote || ""}</td>
            <td>${e.comments || ""}</td>
          </tr>
        `;
      }
      entriesTableBody.innerHTML = rowsHtml;

      updateCoaching(
        { sumKm, targetKm, trimp7, trimp3, avgSleep, avgFluids, avgWellbeing, painCountLast7 },
        { kmScore, sleepScore, fluidsScore, weightScore, loadScore, overallScore }
      );

      updateHero(
        { totalXP, progress, levelPercent },
        { sumKm, avgSleep, avgFluids },
        { kmScore, sleepScore, fluidsScore, weightScore, loadScore, overallScore },
        { kmLevel, sleepLevel, fluidsLevel, weightLevel, loadLevel, avgWellbeing, painCountLast7 }
      );
    }

    // --- Coaching: Tages- & Wochenempfehlung ---
    function updateCoaching(metrics, scores) {
      const {
        sumKm = 0,
        targetKm = 90,
        trimp7 = 0,
        trimp3 = 0,
        avgSleep = null,
        avgFluids = null,
        avgWellbeing = null,
        painCountLast7 = 0
      } = metrics;

      const {
        kmScore = 50,
        sleepScore = 50,
        fluidsScore = 50,
        weightScore = 50,
        loadScore = 50
      } = scores;

      let loadRatio = trimp7 > 0 ? trimp3 / trimp7 : 0;
      let loadFlag = "mittel";
      if (loadRatio > 0.65) loadFlag = "hoch";
      else if (loadRatio < 0.25 && trimp7 > 0) loadFlag = "niedrig";

      let sleepFlag = "okay";
      if (avgSleep != null) {
        if (avgSleep >= 7) sleepFlag = "gut";
        else if (avgSleep < 6) sleepFlag = "schlecht";
      }

      let wellbeingFlag = "neutral";
      if (avgWellbeing != null) {
        if (avgWellbeing >= 4) wellbeingFlag = "gut";
        else if (avgWellbeing <= 2.5) wellbeingFlag = "niedrig";
      }

      const kmRatio = targetKm > 0 ? sumKm / targetKm : 0;
      let trainingState = "unter";
      if (kmRatio >= 0.8 && kmRatio <= 1.1) trainingState = "imPlan";
      else if (kmRatio > 1.1) trainingState = "drüber";

      let dailyTitle = "Empfehlung für morgen";
      let dailyText = "";

      if (painCountLast7 >= 3 || wellbeingFlag === "niedrig" || sleepFlag === "schlecht") {
        dailyTitle = "Morgen: Erholung priorisieren";
        dailyText =
          "Die letzten Tage waren von Schmerzen, niedrigem Wohlbefinden oder wenig Schlaf geprägt. " +
          "Empfehlung: Restday oder maximal 30–45 Minuten sehr locker (RPE 2–3), Fokus auf Schlaf & Ernährung.";
      } else if (loadFlag === "hoch") {
        dailyTitle = "Morgen: sehr ruhiger Tag";
        dailyText =
          "Die Belastung der letzten 3 Tage ist hoch. " +
          "Empfehlung: 40–60 Minuten locker (RPE 3–4) oder kompletter Restday, keine intensiven Einheiten.";
      } else if (trainingState === "unter") {
        dailyTitle = "Morgen: Aufbau-Tag";
        dailyText =
          "Deine Wochenkilometer liegen aktuell unter dem Zielbereich. " +
          "Wenn du dich gut fühlst: 10–14 km lockerer Dauerlauf (RPE 4–5). Fokus auf Struktur, nicht auf Heldentaten.";
      } else if (trainingState === "drüber") {
        dailyTitle = "Morgen: Umfang halten, Intensität runter";
        dailyText =
          "Du liegst diese Woche bereits über deinem Zielumfang. " +
          "Empfehlung: 8–10 km sehr entspannt (RPE 3–4), keine härteren Blöcke.";
      } else {
        dailyTitle = "Morgen: kontrollierter Trainingsreiz";
        dailyText =
          "Belastung, Schlaf & Hydration sehen solide aus. " +
          "Empfehlung: 10–12 km, davon 4–6 km etwas zügiger (RPE 6), Rest locker.";
      }

      if (!entries || entries.length < 3) {
        dailyTitle = "Morgen: Datenbasis noch dünn";
        dailyText =
          "Erst ein paar Tage Training, Schlaf & Flüssigkeit loggen. " +
          "Sobald 3–5 Einträge da sind, werden Empfehlungen genauer.";
      }

      dailyCoachTitleEl.textContent = dailyTitle;
      dailyCoachTextEl.innerHTML = dailyText;

      let weeklyTitle = "Wochenplan basierend auf letzter Woche";
      let weeklyText = "";

      if (!entries || entries.length < 7) {
        weeklyText =
          "Noch nicht genug Daten für eine verlässliche Wochenanalyse. " +
          "Sobald 1–2 Wochen voll getrackt sind, gibt es einen konkreten Wochenfokus.";
        weeklyCoachTitleEl.textContent = weeklyTitle;
        weeklyCoachTextEl.innerHTML = weeklyText;
        return;
      }

      if (kmRatio < 0.6) {
        weeklyText = `
          Deine letzte Woche lag klar unter deinem Zielumfang (~${(kmRatio*100).toFixed(0)} % vom Ziel).<br>
          <strong>Empfohlener Fokus:</strong><br>
          • Ziel: ca. ${(targetKm * 0.7).toFixed(0)}–${(targetKm * 0.85).toFixed(0)} km<br>
          • 3–4 lockere Läufe (RPE 3–5) à 8–12 km<br>
          • 1 langer Lauf um 22–26 km<br>
          • Keine harten Intervalle – zuerst Routine stabil aufbauen.<br>
        `;
      } else if (kmRatio >= 0.6 && kmRatio <= 1.1 && loadScore >= 60) {
        weeklyText = `
          Deine letzte Woche liegt in einem sinnvollen Bereich.<br>
          <strong>Empfohlener Wochenplan:</strong><br>
          • Ziel: ca. ${targetKm.toFixed(0)} km<br>
          • 3 lockere Läufe à 10–12 km (RPE 3–5)<br>
          • 1 Qualitätseinheit (z.B. 6×3 Min zügig, RPE 6–7)<br>
          • 1 langer Lauf: 26–34 km<br>
        `;
      } else if (kmRatio > 1.1 && loadScore >= 60) {
        weeklyText = `
          Du warst letzte Woche eher am oberen Ende (~${(kmRatio*100).toFixed(0)} % vom Zielumfang).<br>
          <strong>Empfohlener Fokus:</strong><br>
          • Ziel: ${(targetKm*0.8).toFixed(0)}–${(targetKm*0.9).toFixed(0)} km<br>
          • 3 lockere Läufe à 8–12 km<br>
          • 1 mittellanger Lauf: 22–28 km<br>
          • Qualität sehr dosiert (max. 1 kurze Tempoeinheit).<br>
        `;
      } else {
        weeklyText = `
          Umfang und Belastung sind etwas unausgeglichen.<br>
          <strong>Empfehlung:</strong><br>
          • Umfang leicht reduzieren, Schlaf & Flüssigkeit optimieren.<br>
          • 3–4 Einheiten locker, 1 langer Lauf, maximal 1 harter Tag.<br>
        `;
      }

      if (painCountLast7 >= 3) {
        weeklyText += "<br><strong>Zusatz:</strong> Mehrere Tage mit Schmerzen – eine Deload-Woche (50–60 % Umfang, keine High-Intensity) ist sinnvoll.";
      }

      weeklyCoachTitleEl.textContent = weeklyTitle;
      weeklyCoachTextEl.innerHTML = weeklyText;
    }

    // --- HERO: Level / Rank / Bars ---
    function updateHero(levelData, miniData, scoreData, labelData) {
      const { totalXP = 0, progress = { level: 1, xpIntoLevel: 0, xpPerLevel: 50 }, levelPercent = 0 } = levelData;
      const { sumKm = null, avgSleep = null, avgFluids = null } = miniData;
      const {
        kmScore = 50,
        sleepScore = 50,
        fluidsScore = 50,
        weightScore = 50,
        loadScore = 50,
        overallScore = null
      } = scoreData;
      const {
        kmLevel, sleepLevel, fluidsLevel, weightLevel, loadLevel,
        avgWellbeing = null, painCountLast7 = 0
      } = labelData;

      heroLevelNumberEl.textContent = progress.level || 1;
      heroProgressFillEl.style.width = `${levelPercent.toFixed(1)}%`;
      heroXPTextEl.textContent = `XP: ${totalXP}`;
      if (progress.level >= 100) {
        heroNextLevelTextEl.textContent = "Max-Level erreicht";
        heroLevelTaglineEl.textContent = "TorTour-Minimum erfüllt";
      } else {
        heroNextLevelTextEl.textContent = `${progress.xpIntoLevel}/${progress.xpPerLevel} XP bis Level ${progress.level + 1}`;
        heroLevelTaglineEl.textContent = "Project 230 · Aufbauphase";
      }

      let statusLine = "";
      if (!overallScore || !entries || entries.length === 0) {
        statusLine = "Noch zu wenige Daten – einfach weiter loggen.";
      } else if (overallScore >= 85) {
        statusLine = "Sehr stabiler Vorbereitungsstand.";
      } else if (overallScore >= 70) {
        statusLine = "Gute Basis, punktuell optimierbar.";
      } else if (overallScore >= 55) {
        statusLine = "Solide Grundlage, aber noch ausbaufähig.";
      } else {
        statusLine = "Aufbau noch wackelig – Struktur & Recovery nachschärfen.";
      }
      heroStatusTextEl.textContent = statusLine;

      heroMiniSleepEl.textContent = avgSleep != null ? avgSleep.toFixed(1) : "–";
      heroMiniKmEl.textContent = sumKm != null ? sumKm.toFixed(1) : "–";
      heroMiniFluidsEl.textContent = avgFluids != null ? avgFluids.toFixed(1) : "–";

      if (!overallScore || !entries || entries.length === 0) {
        heroScoreValueEl.textContent = "–";
        heroRankPillEl.textContent = "RANK –";
        heroScoreChipEl.innerHTML = `<span class="hero-rank-pill" id="heroRankPill">RANK –</span><span>Status: noch offen</span>`;
        heroSummaryBodyEl.textContent = "Sobald die erste Woche gefüllt ist, erscheint hier eine kompakte Bewertung der letzten 7 Tage.";
        heroBarTrainingEl.style.height = "0%";
        heroBarSleepEl.style.height = "0%";
        heroBarFluidsEl.style.height = "0%";
        heroBarWeightEl.style.height = "0%";
        heroBarLoadEl.style.height = "0%";
        heroSummaryTagsEl.innerHTML = "";
        return;
      }

      heroScoreValueEl.textContent = overallScore;

      // Rank-System (S/A/B/C/D)
      let rank = "D";
      if (overallScore >= 90) rank = "S";
      else if (overallScore >= 80) rank = "A";
      else if (overallScore >= 70) rank = "B";
      else if (overallScore >= 55) rank = "C";

      let rankLabel = "";
      if (rank === "S") rankLabel = "Elite-Prep";
      else if (rank === "A") rankLabel = "Strong-Prep";
      else if (rank === "B") rankLabel = "Solid-Prep";
      else if (rank === "C") rankLabel = "Build-Up";
      else rankLabel = "Fragile-Prep";

      heroScoreChipEl.innerHTML =
        `<span class="hero-rank-pill" id="heroRankPill">RANK ${rank}</span>` +
        `<span>Status: ${rankLabel}</span>`;

      let shortText = "";
      if (overallScore >= 85) shortText = "Sehr gute Grundlage – Training, Schlaf und Belastungssteuerung wirken stimmig.";
      else if (overallScore >= 70) shortText = "Gute Vorbereitung – wenige Stellschrauben (v.a. Schlaf & Struktur) bringen zusätzliche Stabilität.";
      else if (overallScore >= 55) shortText = "Solider Start, aber noch nicht wirklich stabil. Fokus auf Routine und Erholung lohnt sich.";
      else shortText = "Aktuell eher wackelige Basis – Umfang, Schlaf und Flüssigkeitszufuhr im Blick behalten.";
      heroSummaryBodyEl.textContent = shortText;

      function scoreToBarHeight(score) {
        if (score >= 85) return 90;
        if (score >= 70) return 70;
        if (score >= 55) return 50;
        return 30;
      }

      function applyBar(barEl, score, level) {
        const h = scoreToBarHeight(score);
        barEl.style.height = h + "%";
        barEl.classList.remove("warn", "bad");
        if (level && level.className === "tag-warn") barEl.classList.add("warn");
        if (level && level.className === "tag-bad") barEl.classList.add("bad");
      }

      applyBar(heroBarTrainingEl, kmScore, kmLevel);
      applyBar(heroBarSleepEl, sleepScore, sleepLevel);
      applyBar(heroBarFluidsEl, fluidsScore, fluidsLevel);
      applyBar(heroBarWeightEl, weightScore, weightLevel);
      applyBar(heroBarLoadEl, loadScore, loadLevel);

      const tags = [];
      if (avgWellbeing != null && avgWellbeing <= 2.5) tags.push("Wohlbefinden niedrig");
      if (painCountLast7 >= 3) tags.push("Mehrere Tage mit Schmerzen");
      if ((avgSleep ?? 0) < 6) tags.push("Schlafdefizit möglich");
      if ((avgFluids ?? 0) < 2) tags.push("Hydration ausbaufähig");
      if (!tags.length) tags.push("Keine akuten Red-Flags");

      heroSummaryTagsEl.innerHTML = tags.map(t => `<span>${t}</span>`).join("");
    }

    function addEntry() {
      const dateVal = entryDateInput.value || new Date().toISOString().substring(0,10);

      const entry = {
        date: dateVal,
        weight: weightInput.value ? parseNumber(weightInput.value) : null,
        trainingType: trainingTypeInput.value || "",
        distanceKm: distanceKmInput.value ? parseNumber(distanceKmInput.value) : null,
        durationMin: durationMinInput.value ? parseNumber(durationMinInput.value) : null,
        rpe: rpeInput.value ? parseNumber(rpeInput.value) : null,
        sleepHours: sleepHoursInput.value ? parseNumber(sleepHoursInput.value) : null,
        sleepQuality: sleepQualityInput.value || "",
        fluidsLiters: fluidsLitersInput.value ? parseNumber(fluidsLitersInput.value) : null,
        wellbeing: wellbeingInput.value ? parseNumber(wellbeingInput.value) : null,
        nightRun: nightRunInput.checked,
        hasPain: hasPainInput.checked,
        painNote: painNoteInput.value || "",
        comments: commentsInput.value || ""
      };

      entries.push(entry);
      saveState(STORAGE_ENTRIES_KEY, entries);

      trainingTypeInput.value = "";
      distanceKmInput.value = "";
      durationMinInput.value = "";
      rpeInput.value = "";
      wellbeingInput.value = "";
      nightRunInput.checked = false;
      hasPainInput.checked = false;
      painNoteInput.value = "";
      commentsInput.value = "";

      updateStats();
    }

    function fillToday() {
      const todayStr = new Date().toISOString().substring(0,10);
      entryDateInput.value = todayStr;
    }

    function clearAllData() {
      if (!confirm("Wirklich alle Daten (Einträge & Einstellungen) löschen? Das kann nicht rückgängig gemacht werden.")) {
        return;
      }
      entries = [];
      settings = {
        raceDate: "",
        targetKm: 90,
        targetSleep: 7.5,
        targetFluids: 2.5
      };
      saveState(STORAGE_ENTRIES_KEY, entries);
      saveState(STORAGE_SETTINGS_KEY, settings);
      initSettingsUI();
      updateRaceSummary();
      updateStats();
    }

    saveSettingsBtn.addEventListener("click", saveSettings);
    addEntryBtn.addEventListener("click", addEntry);
    fillTodayBtn.addEventListener("click", fillToday);
    clearDataLink.addEventListener("click", clearAllData);

    exportJsonBtn.addEventListener("click", exportJSON);
    exportCsvBtn.addEventListener("click", exportCSV);
    importJsonBtn.addEventListener("click", triggerImport);
    importJsonInput.addEventListener("change", handleImportFile);

    (function init() {
      if (!entryDateInput.value) {
        entryDateInput.value = new Date().toISOString().substring(0,10);
      }
      initSettingsUI();
      updateRaceSummary();
      updateStats();
    })();
  </script>
</body>
</html>


